{"ast":null,"code":"\"use strict\";\n\nvar _toConsumableArray = require(\"C:/Users/Neo/Desktop/WWW/react/skynet/skynet/node_modules/@babel/runtime/helpers/toConsumableArray.js\").default;\nvar _classCallCheck = require(\"C:/Users/Neo/Desktop/WWW/react/skynet/skynet/node_modules/@babel/runtime/helpers/classCallCheck.js\").default;\nvar _createClass = require(\"C:/Users/Neo/Desktop/WWW/react/skynet/skynet/node_modules/@babel/runtime/helpers/createClass.js\").default;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Node = void 0;\nvar Util_1 = require(\"./Util\");\nvar Factory_1 = require(\"./Factory\");\nvar Canvas_1 = require(\"./Canvas\");\nvar Global_1 = require(\"./Global\");\nvar DragAndDrop_1 = require(\"./DragAndDrop\");\nvar Validators_1 = require(\"./Validators\");\nvar ABSOLUTE_OPACITY = 'absoluteOpacity',\n  ALL_LISTENERS = 'allEventListeners',\n  ABSOLUTE_TRANSFORM = 'absoluteTransform',\n  ABSOLUTE_SCALE = 'absoluteScale',\n  CANVAS = 'canvas',\n  CHANGE = 'Change',\n  CHILDREN = 'children',\n  KONVA = 'konva',\n  LISTENING = 'listening',\n  MOUSEENTER = 'mouseenter',\n  MOUSELEAVE = 'mouseleave',\n  NAME = 'name',\n  SET = 'set',\n  SHAPE = 'Shape',\n  SPACE = ' ',\n  STAGE = 'stage',\n  TRANSFORM = 'transform',\n  UPPER_STAGE = 'Stage',\n  VISIBLE = 'visible',\n  TRANSFORM_CHANGE_STR = ['xChange.konva', 'yChange.konva', 'scaleXChange.konva', 'scaleYChange.konva', 'skewXChange.konva', 'skewYChange.konva', 'rotationChange.konva', 'offsetXChange.konva', 'offsetYChange.konva', 'transformsEnabledChange.konva'].join(SPACE);\nvar idCounter = 1;\nvar Node = /*#__PURE__*/function () {\n  function Node(config) {\n    _classCallCheck(this, Node);\n    this._id = idCounter++;\n    this.eventListeners = {};\n    this.attrs = {};\n    this.index = 0;\n    this._allEventListeners = null;\n    this.parent = null;\n    this._cache = new Map();\n    this._attachedDepsListeners = new Map();\n    this._lastPos = null;\n    this._batchingTransformChange = false;\n    this._needClearTransformCache = false;\n    this._filterUpToDate = false;\n    this._isUnderCache = false;\n    this._dragEventId = null;\n    this._shouldFireChangeEvents = false;\n    this.setAttrs(config);\n    this._shouldFireChangeEvents = true;\n  }\n  _createClass(Node, [{\n    key: \"hasChildren\",\n    value: function hasChildren() {\n      return false;\n    }\n  }, {\n    key: \"_clearCache\",\n    value: function _clearCache(attr) {\n      if ((attr === TRANSFORM || attr === ABSOLUTE_TRANSFORM) && this._cache.get(attr)) {\n        this._cache.get(attr).dirty = true;\n      } else if (attr) {\n        this._cache.delete(attr);\n      } else {\n        this._cache.clear();\n      }\n    }\n  }, {\n    key: \"_getCache\",\n    value: function _getCache(attr, privateGetter) {\n      var cache = this._cache.get(attr);\n      var isTransform = attr === TRANSFORM || attr === ABSOLUTE_TRANSFORM;\n      var invalid = cache === undefined || isTransform && cache.dirty === true;\n      if (invalid) {\n        cache = privateGetter.call(this);\n        this._cache.set(attr, cache);\n      }\n      return cache;\n    }\n  }, {\n    key: \"_calculate\",\n    value: function _calculate(name, deps, getter) {\n      var _this = this;\n      if (!this._attachedDepsListeners.get(name)) {\n        var depsString = deps.map(function (dep) {\n          return dep + 'Change.konva';\n        }).join(SPACE);\n        this.on(depsString, function () {\n          _this._clearCache(name);\n        });\n        this._attachedDepsListeners.set(name, true);\n      }\n      return this._getCache(name, getter);\n    }\n  }, {\n    key: \"_getCanvasCache\",\n    value: function _getCanvasCache() {\n      return this._cache.get(CANVAS);\n    }\n  }, {\n    key: \"_clearSelfAndDescendantCache\",\n    value: function _clearSelfAndDescendantCache(attr) {\n      this._clearCache(attr);\n      if (attr === ABSOLUTE_TRANSFORM) {\n        this.fire('absoluteTransformChange');\n      }\n    }\n  }, {\n    key: \"clearCache\",\n    value: function clearCache() {\n      if (this._cache.has(CANVAS)) {\n        var _this$_cache$get = this._cache.get(CANVAS),\n          scene = _this$_cache$get.scene,\n          filter = _this$_cache$get.filter,\n          hit = _this$_cache$get.hit;\n        Util_1.Util.releaseCanvas(scene, filter, hit);\n        this._cache.delete(CANVAS);\n      }\n      this._clearSelfAndDescendantCache();\n      this._requestDraw();\n      return this;\n    }\n  }, {\n    key: \"cache\",\n    value: function cache(config) {\n      var conf = config || {};\n      var rect = {};\n      if (conf.x === undefined || conf.y === undefined || conf.width === undefined || conf.height === undefined) {\n        rect = this.getClientRect({\n          skipTransform: true,\n          relativeTo: this.getParent()\n        });\n      }\n      var width = Math.ceil(conf.width || rect.width),\n        height = Math.ceil(conf.height || rect.height),\n        pixelRatio = conf.pixelRatio,\n        x = conf.x === undefined ? Math.floor(rect.x) : conf.x,\n        y = conf.y === undefined ? Math.floor(rect.y) : conf.y,\n        offset = conf.offset || 0,\n        drawBorder = conf.drawBorder || false,\n        hitCanvasPixelRatio = conf.hitCanvasPixelRatio || 1;\n      if (!width || !height) {\n        Util_1.Util.error('Can not cache the node. Width or height of the node equals 0. Caching is skipped.');\n        return;\n      }\n      width += offset * 2 + 1;\n      height += offset * 2 + 1;\n      x -= offset;\n      y -= offset;\n      var cachedSceneCanvas = new Canvas_1.SceneCanvas({\n          pixelRatio: pixelRatio,\n          width: width,\n          height: height\n        }),\n        cachedFilterCanvas = new Canvas_1.SceneCanvas({\n          pixelRatio: pixelRatio,\n          width: 0,\n          height: 0,\n          willReadFrequently: true\n        }),\n        cachedHitCanvas = new Canvas_1.HitCanvas({\n          pixelRatio: hitCanvasPixelRatio,\n          width: width,\n          height: height\n        }),\n        sceneContext = cachedSceneCanvas.getContext(),\n        hitContext = cachedHitCanvas.getContext();\n      cachedHitCanvas.isCache = true;\n      cachedSceneCanvas.isCache = true;\n      this._cache.delete(CANVAS);\n      this._filterUpToDate = false;\n      if (conf.imageSmoothingEnabled === false) {\n        cachedSceneCanvas.getContext()._context.imageSmoothingEnabled = false;\n        cachedFilterCanvas.getContext()._context.imageSmoothingEnabled = false;\n      }\n      sceneContext.save();\n      hitContext.save();\n      sceneContext.translate(-x, -y);\n      hitContext.translate(-x, -y);\n      this._isUnderCache = true;\n      this._clearSelfAndDescendantCache(ABSOLUTE_OPACITY);\n      this._clearSelfAndDescendantCache(ABSOLUTE_SCALE);\n      this.drawScene(cachedSceneCanvas, this);\n      this.drawHit(cachedHitCanvas, this);\n      this._isUnderCache = false;\n      sceneContext.restore();\n      hitContext.restore();\n      if (drawBorder) {\n        sceneContext.save();\n        sceneContext.beginPath();\n        sceneContext.rect(0, 0, width, height);\n        sceneContext.closePath();\n        sceneContext.setAttr('strokeStyle', 'red');\n        sceneContext.setAttr('lineWidth', 5);\n        sceneContext.stroke();\n        sceneContext.restore();\n      }\n      this._cache.set(CANVAS, {\n        scene: cachedSceneCanvas,\n        filter: cachedFilterCanvas,\n        hit: cachedHitCanvas,\n        x: x,\n        y: y\n      });\n      this._requestDraw();\n      return this;\n    }\n  }, {\n    key: \"isCached\",\n    value: function isCached() {\n      return this._cache.has(CANVAS);\n    }\n  }, {\n    key: \"getClientRect\",\n    value: function getClientRect(config) {\n      throw new Error('abstract \"getClientRect\" method call');\n    }\n  }, {\n    key: \"_transformedRect\",\n    value: function _transformedRect(rect, top) {\n      var points = [{\n        x: rect.x,\n        y: rect.y\n      }, {\n        x: rect.x + rect.width,\n        y: rect.y\n      }, {\n        x: rect.x + rect.width,\n        y: rect.y + rect.height\n      }, {\n        x: rect.x,\n        y: rect.y + rect.height\n      }];\n      var minX, minY, maxX, maxY;\n      var trans = this.getAbsoluteTransform(top);\n      points.forEach(function (point) {\n        var transformed = trans.point(point);\n        if (minX === undefined) {\n          minX = maxX = transformed.x;\n          minY = maxY = transformed.y;\n        }\n        minX = Math.min(minX, transformed.x);\n        minY = Math.min(minY, transformed.y);\n        maxX = Math.max(maxX, transformed.x);\n        maxY = Math.max(maxY, transformed.y);\n      });\n      return {\n        x: minX,\n        y: minY,\n        width: maxX - minX,\n        height: maxY - minY\n      };\n    }\n  }, {\n    key: \"_drawCachedSceneCanvas\",\n    value: function _drawCachedSceneCanvas(context) {\n      context.save();\n      context._applyOpacity(this);\n      context._applyGlobalCompositeOperation(this);\n      var canvasCache = this._getCanvasCache();\n      context.translate(canvasCache.x, canvasCache.y);\n      var cacheCanvas = this._getCachedSceneCanvas();\n      var ratio = cacheCanvas.pixelRatio;\n      context.drawImage(cacheCanvas._canvas, 0, 0, cacheCanvas.width / ratio, cacheCanvas.height / ratio);\n      context.restore();\n    }\n  }, {\n    key: \"_drawCachedHitCanvas\",\n    value: function _drawCachedHitCanvas(context) {\n      var canvasCache = this._getCanvasCache(),\n        hitCanvas = canvasCache.hit;\n      context.save();\n      context.translate(canvasCache.x, canvasCache.y);\n      context.drawImage(hitCanvas._canvas, 0, 0, hitCanvas.width / hitCanvas.pixelRatio, hitCanvas.height / hitCanvas.pixelRatio);\n      context.restore();\n    }\n  }, {\n    key: \"_getCachedSceneCanvas\",\n    value: function _getCachedSceneCanvas() {\n      var filters = this.filters(),\n        cachedCanvas = this._getCanvasCache(),\n        sceneCanvas = cachedCanvas.scene,\n        filterCanvas = cachedCanvas.filter,\n        filterContext = filterCanvas.getContext(),\n        len,\n        imageData,\n        n,\n        filter;\n      if (filters) {\n        if (!this._filterUpToDate) {\n          var ratio = sceneCanvas.pixelRatio;\n          filterCanvas.setSize(sceneCanvas.width / sceneCanvas.pixelRatio, sceneCanvas.height / sceneCanvas.pixelRatio);\n          try {\n            len = filters.length;\n            filterContext.clear();\n            filterContext.drawImage(sceneCanvas._canvas, 0, 0, sceneCanvas.getWidth() / ratio, sceneCanvas.getHeight() / ratio);\n            imageData = filterContext.getImageData(0, 0, filterCanvas.getWidth(), filterCanvas.getHeight());\n            for (n = 0; n < len; n++) {\n              filter = filters[n];\n              if (typeof filter !== 'function') {\n                Util_1.Util.error('Filter should be type of function, but got ' + typeof filter + ' instead. Please check correct filters');\n                continue;\n              }\n              filter.call(this, imageData);\n              filterContext.putImageData(imageData, 0, 0);\n            }\n          } catch (e) {\n            Util_1.Util.error('Unable to apply filter. ' + e.message + ' This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.');\n          }\n          this._filterUpToDate = true;\n        }\n        return filterCanvas;\n      }\n      return sceneCanvas;\n    }\n  }, {\n    key: \"on\",\n    value: function on(evtStr, handler) {\n      this._cache && this._cache.delete(ALL_LISTENERS);\n      if (arguments.length === 3) {\n        return this._delegate.apply(this, arguments);\n      }\n      var events = evtStr.split(SPACE),\n        len = events.length,\n        n,\n        event,\n        parts,\n        baseEvent,\n        name;\n      for (n = 0; n < len; n++) {\n        event = events[n];\n        parts = event.split('.');\n        baseEvent = parts[0];\n        name = parts[1] || '';\n        if (!this.eventListeners[baseEvent]) {\n          this.eventListeners[baseEvent] = [];\n        }\n        this.eventListeners[baseEvent].push({\n          name: name,\n          handler: handler\n        });\n      }\n      return this;\n    }\n  }, {\n    key: \"off\",\n    value: function off(evtStr, callback) {\n      var events = (evtStr || '').split(SPACE),\n        len = events.length,\n        n,\n        t,\n        event,\n        parts,\n        baseEvent,\n        name;\n      this._cache && this._cache.delete(ALL_LISTENERS);\n      if (!evtStr) {\n        for (t in this.eventListeners) {\n          this._off(t);\n        }\n      }\n      for (n = 0; n < len; n++) {\n        event = events[n];\n        parts = event.split('.');\n        baseEvent = parts[0];\n        name = parts[1];\n        if (baseEvent) {\n          if (this.eventListeners[baseEvent]) {\n            this._off(baseEvent, name, callback);\n          }\n        } else {\n          for (t in this.eventListeners) {\n            this._off(t, name, callback);\n          }\n        }\n      }\n      return this;\n    }\n  }, {\n    key: \"dispatchEvent\",\n    value: function dispatchEvent(evt) {\n      var e = {\n        target: this,\n        type: evt.type,\n        evt: evt\n      };\n      this.fire(evt.type, e);\n      return this;\n    }\n  }, {\n    key: \"addEventListener\",\n    value: function addEventListener(type, handler) {\n      this.on(type, function (evt) {\n        handler.call(this, evt.evt);\n      });\n      return this;\n    }\n  }, {\n    key: \"removeEventListener\",\n    value: function removeEventListener(type) {\n      this.off(type);\n      return this;\n    }\n  }, {\n    key: \"_delegate\",\n    value: function _delegate(event, selector, handler) {\n      var stopNode = this;\n      this.on(event, function (evt) {\n        var targets = evt.target.findAncestors(selector, true, stopNode);\n        for (var i = 0; i < targets.length; i++) {\n          evt = Util_1.Util.cloneObject(evt);\n          evt.currentTarget = targets[i];\n          handler.call(targets[i], evt);\n        }\n      });\n    }\n  }, {\n    key: \"remove\",\n    value: function remove() {\n      if (this.isDragging()) {\n        this.stopDrag();\n      }\n      DragAndDrop_1.DD._dragElements.delete(this._id);\n      this._remove();\n      return this;\n    }\n  }, {\n    key: \"_clearCaches\",\n    value: function _clearCaches() {\n      this._clearSelfAndDescendantCache(ABSOLUTE_TRANSFORM);\n      this._clearSelfAndDescendantCache(ABSOLUTE_OPACITY);\n      this._clearSelfAndDescendantCache(ABSOLUTE_SCALE);\n      this._clearSelfAndDescendantCache(STAGE);\n      this._clearSelfAndDescendantCache(VISIBLE);\n      this._clearSelfAndDescendantCache(LISTENING);\n    }\n  }, {\n    key: \"_remove\",\n    value: function _remove() {\n      this._clearCaches();\n      var parent = this.getParent();\n      if (parent && parent.children) {\n        parent.children.splice(this.index, 1);\n        parent._setChildrenIndices();\n        this.parent = null;\n      }\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      this.remove();\n      this.clearCache();\n      return this;\n    }\n  }, {\n    key: \"getAttr\",\n    value: function getAttr(attr) {\n      var method = 'get' + Util_1.Util._capitalize(attr);\n      if (Util_1.Util._isFunction(this[method])) {\n        return this[method]();\n      }\n      return this.attrs[attr];\n    }\n  }, {\n    key: \"getAncestors\",\n    value: function getAncestors() {\n      var parent = this.getParent(),\n        ancestors = [];\n      while (parent) {\n        ancestors.push(parent);\n        parent = parent.getParent();\n      }\n      return ancestors;\n    }\n  }, {\n    key: \"getAttrs\",\n    value: function getAttrs() {\n      return this.attrs || {};\n    }\n  }, {\n    key: \"setAttrs\",\n    value: function setAttrs(config) {\n      var _this2 = this;\n      this._batchTransformChanges(function () {\n        var key, method;\n        if (!config) {\n          return _this2;\n        }\n        for (key in config) {\n          if (key === CHILDREN) {\n            continue;\n          }\n          method = SET + Util_1.Util._capitalize(key);\n          if (Util_1.Util._isFunction(_this2[method])) {\n            _this2[method](config[key]);\n          } else {\n            _this2._setAttr(key, config[key]);\n          }\n        }\n      });\n      return this;\n    }\n  }, {\n    key: \"isListening\",\n    value: function isListening() {\n      return this._getCache(LISTENING, this._isListening);\n    }\n  }, {\n    key: \"_isListening\",\n    value: function _isListening(relativeTo) {\n      var listening = this.listening();\n      if (!listening) {\n        return false;\n      }\n      var parent = this.getParent();\n      if (parent && parent !== relativeTo && this !== relativeTo) {\n        return parent._isListening(relativeTo);\n      } else {\n        return true;\n      }\n    }\n  }, {\n    key: \"isVisible\",\n    value: function isVisible() {\n      return this._getCache(VISIBLE, this._isVisible);\n    }\n  }, {\n    key: \"_isVisible\",\n    value: function _isVisible(relativeTo) {\n      var visible = this.visible();\n      if (!visible) {\n        return false;\n      }\n      var parent = this.getParent();\n      if (parent && parent !== relativeTo && this !== relativeTo) {\n        return parent._isVisible(relativeTo);\n      } else {\n        return true;\n      }\n    }\n  }, {\n    key: \"shouldDrawHit\",\n    value: function shouldDrawHit(top) {\n      var skipDragCheck = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      if (top) {\n        return this._isVisible(top) && this._isListening(top);\n      }\n      var layer = this.getLayer();\n      var layerUnderDrag = false;\n      DragAndDrop_1.DD._dragElements.forEach(function (elem) {\n        if (elem.dragStatus !== 'dragging') {\n          return;\n        } else if (elem.node.nodeType === 'Stage') {\n          layerUnderDrag = true;\n        } else if (elem.node.getLayer() === layer) {\n          layerUnderDrag = true;\n        }\n      });\n      var dragSkip = !skipDragCheck && !Global_1.Konva.hitOnDragEnabled && layerUnderDrag;\n      return this.isListening() && this.isVisible() && !dragSkip;\n    }\n  }, {\n    key: \"show\",\n    value: function show() {\n      this.visible(true);\n      return this;\n    }\n  }, {\n    key: \"hide\",\n    value: function hide() {\n      this.visible(false);\n      return this;\n    }\n  }, {\n    key: \"getZIndex\",\n    value: function getZIndex() {\n      return this.index || 0;\n    }\n  }, {\n    key: \"getAbsoluteZIndex\",\n    value: function getAbsoluteZIndex() {\n      var depth = this.getDepth(),\n        that = this,\n        index = 0,\n        nodes,\n        len,\n        n,\n        child;\n      function addChildren(children) {\n        nodes = [];\n        len = children.length;\n        for (n = 0; n < len; n++) {\n          child = children[n];\n          index++;\n          if (child.nodeType !== SHAPE) {\n            nodes = nodes.concat(child.getChildren().slice());\n          }\n          if (child._id === that._id) {\n            n = len;\n          }\n        }\n        if (nodes.length > 0 && nodes[0].getDepth() <= depth) {\n          addChildren(nodes);\n        }\n      }\n      if (that.nodeType !== UPPER_STAGE) {\n        addChildren(that.getStage().getChildren());\n      }\n      return index;\n    }\n  }, {\n    key: \"getDepth\",\n    value: function getDepth() {\n      var depth = 0,\n        parent = this.parent;\n      while (parent) {\n        depth++;\n        parent = parent.parent;\n      }\n      return depth;\n    }\n  }, {\n    key: \"_batchTransformChanges\",\n    value: function _batchTransformChanges(func) {\n      this._batchingTransformChange = true;\n      func();\n      this._batchingTransformChange = false;\n      if (this._needClearTransformCache) {\n        this._clearCache(TRANSFORM);\n        this._clearSelfAndDescendantCache(ABSOLUTE_TRANSFORM);\n      }\n      this._needClearTransformCache = false;\n    }\n  }, {\n    key: \"setPosition\",\n    value: function setPosition(pos) {\n      var _this3 = this;\n      this._batchTransformChanges(function () {\n        _this3.x(pos.x);\n        _this3.y(pos.y);\n      });\n      return this;\n    }\n  }, {\n    key: \"getPosition\",\n    value: function getPosition() {\n      return {\n        x: this.x(),\n        y: this.y()\n      };\n    }\n  }, {\n    key: \"getRelativePointerPosition\",\n    value: function getRelativePointerPosition() {\n      if (!this.getStage()) {\n        return null;\n      }\n      var pos = this.getStage().getPointerPosition();\n      if (!pos) {\n        return null;\n      }\n      var transform = this.getAbsoluteTransform().copy();\n      transform.invert();\n      return transform.point(pos);\n    }\n  }, {\n    key: \"getAbsolutePosition\",\n    value: function getAbsolutePosition(top) {\n      var haveCachedParent = false;\n      var parent = this.parent;\n      while (parent) {\n        if (parent.isCached()) {\n          haveCachedParent = true;\n          break;\n        }\n        parent = parent.parent;\n      }\n      if (haveCachedParent && !top) {\n        top = true;\n      }\n      var absoluteMatrix = this.getAbsoluteTransform(top).getMatrix(),\n        absoluteTransform = new Util_1.Transform(),\n        offset = this.offset();\n      absoluteTransform.m = absoluteMatrix.slice();\n      absoluteTransform.translate(offset.x, offset.y);\n      return absoluteTransform.getTranslation();\n    }\n  }, {\n    key: \"setAbsolutePosition\",\n    value: function setAbsolutePosition(pos) {\n      var origTrans = this._clearTransform();\n      this.attrs.x = origTrans.x;\n      this.attrs.y = origTrans.y;\n      delete origTrans.x;\n      delete origTrans.y;\n      this._clearCache(TRANSFORM);\n      var it = this._getAbsoluteTransform().copy();\n      it.invert();\n      it.translate(pos.x, pos.y);\n      pos = {\n        x: this.attrs.x + it.getTranslation().x,\n        y: this.attrs.y + it.getTranslation().y\n      };\n      this._setTransform(origTrans);\n      this.setPosition({\n        x: pos.x,\n        y: pos.y\n      });\n      this._clearCache(TRANSFORM);\n      this._clearSelfAndDescendantCache(ABSOLUTE_TRANSFORM);\n      return this;\n    }\n  }, {\n    key: \"_setTransform\",\n    value: function _setTransform(trans) {\n      var key;\n      for (key in trans) {\n        this.attrs[key] = trans[key];\n      }\n    }\n  }, {\n    key: \"_clearTransform\",\n    value: function _clearTransform() {\n      var trans = {\n        x: this.x(),\n        y: this.y(),\n        rotation: this.rotation(),\n        scaleX: this.scaleX(),\n        scaleY: this.scaleY(),\n        offsetX: this.offsetX(),\n        offsetY: this.offsetY(),\n        skewX: this.skewX(),\n        skewY: this.skewY()\n      };\n      this.attrs.x = 0;\n      this.attrs.y = 0;\n      this.attrs.rotation = 0;\n      this.attrs.scaleX = 1;\n      this.attrs.scaleY = 1;\n      this.attrs.offsetX = 0;\n      this.attrs.offsetY = 0;\n      this.attrs.skewX = 0;\n      this.attrs.skewY = 0;\n      return trans;\n    }\n  }, {\n    key: \"move\",\n    value: function move(change) {\n      var changeX = change.x,\n        changeY = change.y,\n        x = this.x(),\n        y = this.y();\n      if (changeX !== undefined) {\n        x += changeX;\n      }\n      if (changeY !== undefined) {\n        y += changeY;\n      }\n      this.setPosition({\n        x: x,\n        y: y\n      });\n      return this;\n    }\n  }, {\n    key: \"_eachAncestorReverse\",\n    value: function _eachAncestorReverse(func, top) {\n      var family = [],\n        parent = this.getParent(),\n        len,\n        n;\n      if (top && top._id === this._id) {\n        return;\n      }\n      family.unshift(this);\n      while (parent && (!top || parent._id !== top._id)) {\n        family.unshift(parent);\n        parent = parent.parent;\n      }\n      len = family.length;\n      for (n = 0; n < len; n++) {\n        func(family[n]);\n      }\n    }\n  }, {\n    key: \"rotate\",\n    value: function rotate(theta) {\n      this.rotation(this.rotation() + theta);\n      return this;\n    }\n  }, {\n    key: \"moveToTop\",\n    value: function moveToTop() {\n      if (!this.parent) {\n        Util_1.Util.warn('Node has no parent. moveToTop function is ignored.');\n        return false;\n      }\n      var index = this.index,\n        len = this.parent.getChildren().length;\n      if (index < len - 1) {\n        this.parent.children.splice(index, 1);\n        this.parent.children.push(this);\n        this.parent._setChildrenIndices();\n        return true;\n      }\n      return false;\n    }\n  }, {\n    key: \"moveUp\",\n    value: function moveUp() {\n      if (!this.parent) {\n        Util_1.Util.warn('Node has no parent. moveUp function is ignored.');\n        return false;\n      }\n      var index = this.index,\n        len = this.parent.getChildren().length;\n      if (index < len - 1) {\n        this.parent.children.splice(index, 1);\n        this.parent.children.splice(index + 1, 0, this);\n        this.parent._setChildrenIndices();\n        return true;\n      }\n      return false;\n    }\n  }, {\n    key: \"moveDown\",\n    value: function moveDown() {\n      if (!this.parent) {\n        Util_1.Util.warn('Node has no parent. moveDown function is ignored.');\n        return false;\n      }\n      var index = this.index;\n      if (index > 0) {\n        this.parent.children.splice(index, 1);\n        this.parent.children.splice(index - 1, 0, this);\n        this.parent._setChildrenIndices();\n        return true;\n      }\n      return false;\n    }\n  }, {\n    key: \"moveToBottom\",\n    value: function moveToBottom() {\n      if (!this.parent) {\n        Util_1.Util.warn('Node has no parent. moveToBottom function is ignored.');\n        return false;\n      }\n      var index = this.index;\n      if (index > 0) {\n        this.parent.children.splice(index, 1);\n        this.parent.children.unshift(this);\n        this.parent._setChildrenIndices();\n        return true;\n      }\n      return false;\n    }\n  }, {\n    key: \"setZIndex\",\n    value: function setZIndex(zIndex) {\n      if (!this.parent) {\n        Util_1.Util.warn('Node has no parent. zIndex parameter is ignored.');\n        return this;\n      }\n      if (zIndex < 0 || zIndex >= this.parent.children.length) {\n        Util_1.Util.warn('Unexpected value ' + zIndex + ' for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to ' + (this.parent.children.length - 1) + '.');\n      }\n      var index = this.index;\n      this.parent.children.splice(index, 1);\n      this.parent.children.splice(zIndex, 0, this);\n      this.parent._setChildrenIndices();\n      return this;\n    }\n  }, {\n    key: \"getAbsoluteOpacity\",\n    value: function getAbsoluteOpacity() {\n      return this._getCache(ABSOLUTE_OPACITY, this._getAbsoluteOpacity);\n    }\n  }, {\n    key: \"_getAbsoluteOpacity\",\n    value: function _getAbsoluteOpacity() {\n      var absOpacity = this.opacity();\n      var parent = this.getParent();\n      if (parent && !parent._isUnderCache) {\n        absOpacity *= parent.getAbsoluteOpacity();\n      }\n      return absOpacity;\n    }\n  }, {\n    key: \"moveTo\",\n    value: function moveTo(newContainer) {\n      if (this.getParent() !== newContainer) {\n        this._remove();\n        newContainer.add(this);\n      }\n      return this;\n    }\n  }, {\n    key: \"toObject\",\n    value: function toObject() {\n      var obj = {},\n        attrs = this.getAttrs(),\n        key,\n        val,\n        getter,\n        defaultValue,\n        nonPlainObject;\n      obj.attrs = {};\n      for (key in attrs) {\n        val = attrs[key];\n        nonPlainObject = Util_1.Util.isObject(val) && !Util_1.Util._isPlainObject(val) && !Util_1.Util._isArray(val);\n        if (nonPlainObject) {\n          continue;\n        }\n        getter = typeof this[key] === 'function' && this[key];\n        delete attrs[key];\n        defaultValue = getter ? getter.call(this) : null;\n        attrs[key] = val;\n        if (defaultValue !== val) {\n          obj.attrs[key] = val;\n        }\n      }\n      obj.className = this.getClassName();\n      return Util_1.Util._prepareToStringify(obj);\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      return JSON.stringify(this.toObject());\n    }\n  }, {\n    key: \"getParent\",\n    value: function getParent() {\n      return this.parent;\n    }\n  }, {\n    key: \"findAncestors\",\n    value: function findAncestors(selector, includeSelf, stopNode) {\n      var res = [];\n      if (includeSelf && this._isMatch(selector)) {\n        res.push(this);\n      }\n      var ancestor = this.parent;\n      while (ancestor) {\n        if (ancestor === stopNode) {\n          return res;\n        }\n        if (ancestor._isMatch(selector)) {\n          res.push(ancestor);\n        }\n        ancestor = ancestor.parent;\n      }\n      return res;\n    }\n  }, {\n    key: \"isAncestorOf\",\n    value: function isAncestorOf(node) {\n      return false;\n    }\n  }, {\n    key: \"findAncestor\",\n    value: function findAncestor(selector, includeSelf, stopNode) {\n      return this.findAncestors(selector, includeSelf, stopNode)[0];\n    }\n  }, {\n    key: \"_isMatch\",\n    value: function _isMatch(selector) {\n      if (!selector) {\n        return false;\n      }\n      if (typeof selector === 'function') {\n        return selector(this);\n      }\n      var selectorArr = selector.replace(/ /g, '').split(','),\n        len = selectorArr.length,\n        n,\n        sel;\n      for (n = 0; n < len; n++) {\n        sel = selectorArr[n];\n        if (!Util_1.Util.isValidSelector(sel)) {\n          Util_1.Util.warn('Selector \"' + sel + '\" is invalid. Allowed selectors examples are \"#foo\", \".bar\" or \"Group\".');\n          Util_1.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like \"Triangle\".');\n          Util_1.Util.warn('Konva is awesome, right?');\n        }\n        if (sel.charAt(0) === '#') {\n          if (this.id() === sel.slice(1)) {\n            return true;\n          }\n        } else if (sel.charAt(0) === '.') {\n          if (this.hasName(sel.slice(1))) {\n            return true;\n          }\n        } else if (this.className === sel || this.nodeType === sel) {\n          return true;\n        }\n      }\n      return false;\n    }\n  }, {\n    key: \"getLayer\",\n    value: function getLayer() {\n      var parent = this.getParent();\n      return parent ? parent.getLayer() : null;\n    }\n  }, {\n    key: \"getStage\",\n    value: function getStage() {\n      return this._getCache(STAGE, this._getStage);\n    }\n  }, {\n    key: \"_getStage\",\n    value: function _getStage() {\n      var parent = this.getParent();\n      if (parent) {\n        return parent.getStage();\n      } else {\n        return undefined;\n      }\n    }\n  }, {\n    key: \"fire\",\n    value: function fire(eventType) {\n      var evt = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var bubble = arguments.length > 2 ? arguments[2] : undefined;\n      evt.target = evt.target || this;\n      if (bubble) {\n        this._fireAndBubble(eventType, evt);\n      } else {\n        this._fire(eventType, evt);\n      }\n      return this;\n    }\n  }, {\n    key: \"getAbsoluteTransform\",\n    value: function getAbsoluteTransform(top) {\n      if (top) {\n        return this._getAbsoluteTransform(top);\n      } else {\n        return this._getCache(ABSOLUTE_TRANSFORM, this._getAbsoluteTransform);\n      }\n    }\n  }, {\n    key: \"_getAbsoluteTransform\",\n    value: function _getAbsoluteTransform(top) {\n      var at;\n      if (top) {\n        at = new Util_1.Transform();\n        this._eachAncestorReverse(function (node) {\n          var transformsEnabled = node.transformsEnabled();\n          if (transformsEnabled === 'all') {\n            at.multiply(node.getTransform());\n          } else if (transformsEnabled === 'position') {\n            at.translate(node.x() - node.offsetX(), node.y() - node.offsetY());\n          }\n        }, top);\n        return at;\n      } else {\n        at = this._cache.get(ABSOLUTE_TRANSFORM) || new Util_1.Transform();\n        if (this.parent) {\n          this.parent.getAbsoluteTransform().copyInto(at);\n        } else {\n          at.reset();\n        }\n        var transformsEnabled = this.transformsEnabled();\n        if (transformsEnabled === 'all') {\n          at.multiply(this.getTransform());\n        } else if (transformsEnabled === 'position') {\n          var x = this.attrs.x || 0;\n          var y = this.attrs.y || 0;\n          var offsetX = this.attrs.offsetX || 0;\n          var offsetY = this.attrs.offsetY || 0;\n          at.translate(x - offsetX, y - offsetY);\n        }\n        at.dirty = false;\n        return at;\n      }\n    }\n  }, {\n    key: \"getAbsoluteScale\",\n    value: function getAbsoluteScale(top) {\n      var parent = this;\n      while (parent) {\n        if (parent._isUnderCache) {\n          top = parent;\n        }\n        parent = parent.getParent();\n      }\n      var transform = this.getAbsoluteTransform(top);\n      var attrs = transform.decompose();\n      return {\n        x: attrs.scaleX,\n        y: attrs.scaleY\n      };\n    }\n  }, {\n    key: \"getAbsoluteRotation\",\n    value: function getAbsoluteRotation() {\n      return this.getAbsoluteTransform().decompose().rotation;\n    }\n  }, {\n    key: \"getTransform\",\n    value: function getTransform() {\n      return this._getCache(TRANSFORM, this._getTransform);\n    }\n  }, {\n    key: \"_getTransform\",\n    value: function _getTransform() {\n      var _a, _b;\n      var m = this._cache.get(TRANSFORM) || new Util_1.Transform();\n      m.reset();\n      var x = this.x(),\n        y = this.y(),\n        rotation = Global_1.Konva.getAngle(this.rotation()),\n        scaleX = (_a = this.attrs.scaleX) !== null && _a !== void 0 ? _a : 1,\n        scaleY = (_b = this.attrs.scaleY) !== null && _b !== void 0 ? _b : 1,\n        skewX = this.attrs.skewX || 0,\n        skewY = this.attrs.skewY || 0,\n        offsetX = this.attrs.offsetX || 0,\n        offsetY = this.attrs.offsetY || 0;\n      if (x !== 0 || y !== 0) {\n        m.translate(x, y);\n      }\n      if (rotation !== 0) {\n        m.rotate(rotation);\n      }\n      if (skewX !== 0 || skewY !== 0) {\n        m.skew(skewX, skewY);\n      }\n      if (scaleX !== 1 || scaleY !== 1) {\n        m.scale(scaleX, scaleY);\n      }\n      if (offsetX !== 0 || offsetY !== 0) {\n        m.translate(-1 * offsetX, -1 * offsetY);\n      }\n      m.dirty = false;\n      return m;\n    }\n  }, {\n    key: \"clone\",\n    value: function clone(obj) {\n      var attrs = Util_1.Util.cloneObject(this.attrs),\n        key,\n        allListeners,\n        len,\n        n,\n        listener;\n      for (key in obj) {\n        attrs[key] = obj[key];\n      }\n      var node = new this.constructor(attrs);\n      for (key in this.eventListeners) {\n        allListeners = this.eventListeners[key];\n        len = allListeners.length;\n        for (n = 0; n < len; n++) {\n          listener = allListeners[n];\n          if (listener.name.indexOf(KONVA) < 0) {\n            if (!node.eventListeners[key]) {\n              node.eventListeners[key] = [];\n            }\n            node.eventListeners[key].push(listener);\n          }\n        }\n      }\n      return node;\n    }\n  }, {\n    key: \"_toKonvaCanvas\",\n    value: function _toKonvaCanvas(config) {\n      config = config || {};\n      var box = this.getClientRect();\n      var stage = this.getStage(),\n        x = config.x !== undefined ? config.x : Math.floor(box.x),\n        y = config.y !== undefined ? config.y : Math.floor(box.y),\n        pixelRatio = config.pixelRatio || 1,\n        canvas = new Canvas_1.SceneCanvas({\n          width: config.width || Math.ceil(box.width) || (stage ? stage.width() : 0),\n          height: config.height || Math.ceil(box.height) || (stage ? stage.height() : 0),\n          pixelRatio: pixelRatio\n        }),\n        context = canvas.getContext();\n      if (config.imageSmoothingEnabled === false) {\n        context._context.imageSmoothingEnabled = false;\n      }\n      context.save();\n      if (x || y) {\n        context.translate(-1 * x, -1 * y);\n      }\n      this.drawScene(canvas);\n      context.restore();\n      return canvas;\n    }\n  }, {\n    key: \"toCanvas\",\n    value: function toCanvas(config) {\n      return this._toKonvaCanvas(config)._canvas;\n    }\n  }, {\n    key: \"toDataURL\",\n    value: function toDataURL(config) {\n      config = config || {};\n      var mimeType = config.mimeType || null,\n        quality = config.quality || null;\n      var url = this._toKonvaCanvas(config).toDataURL(mimeType, quality);\n      if (config.callback) {\n        config.callback(url);\n      }\n      return url;\n    }\n  }, {\n    key: \"toImage\",\n    value: function toImage(config) {\n      var _this4 = this;\n      return new Promise(function (resolve, reject) {\n        try {\n          var callback = config === null || config === void 0 ? void 0 : config.callback;\n          if (callback) delete config.callback;\n          Util_1.Util._urlToImage(_this4.toDataURL(config), function (img) {\n            resolve(img);\n            callback === null || callback === void 0 ? void 0 : callback(img);\n          });\n        } catch (err) {\n          reject(err);\n        }\n      });\n    }\n  }, {\n    key: \"toBlob\",\n    value: function toBlob(config) {\n      var _this5 = this;\n      return new Promise(function (resolve, reject) {\n        try {\n          var callback = config === null || config === void 0 ? void 0 : config.callback;\n          if (callback) delete config.callback;\n          _this5.toCanvas(config).toBlob(function (blob) {\n            resolve(blob);\n            callback === null || callback === void 0 ? void 0 : callback(blob);\n          });\n        } catch (err) {\n          reject(err);\n        }\n      });\n    }\n  }, {\n    key: \"setSize\",\n    value: function setSize(size) {\n      this.width(size.width);\n      this.height(size.height);\n      return this;\n    }\n  }, {\n    key: \"getSize\",\n    value: function getSize() {\n      return {\n        width: this.width(),\n        height: this.height()\n      };\n    }\n  }, {\n    key: \"getClassName\",\n    value: function getClassName() {\n      return this.className || this.nodeType;\n    }\n  }, {\n    key: \"getType\",\n    value: function getType() {\n      return this.nodeType;\n    }\n  }, {\n    key: \"getDragDistance\",\n    value: function getDragDistance() {\n      if (this.attrs.dragDistance !== undefined) {\n        return this.attrs.dragDistance;\n      } else if (this.parent) {\n        return this.parent.getDragDistance();\n      } else {\n        return Global_1.Konva.dragDistance;\n      }\n    }\n  }, {\n    key: \"_off\",\n    value: function _off(type, name, callback) {\n      var evtListeners = this.eventListeners[type],\n        i,\n        evtName,\n        handler;\n      for (i = 0; i < evtListeners.length; i++) {\n        evtName = evtListeners[i].name;\n        handler = evtListeners[i].handler;\n        if ((evtName !== 'konva' || name === 'konva') && (!name || evtName === name) && (!callback || callback === handler)) {\n          evtListeners.splice(i, 1);\n          if (evtListeners.length === 0) {\n            delete this.eventListeners[type];\n            break;\n          }\n          i--;\n        }\n      }\n    }\n  }, {\n    key: \"_fireChangeEvent\",\n    value: function _fireChangeEvent(attr, oldVal, newVal) {\n      this._fire(attr + CHANGE, {\n        oldVal: oldVal,\n        newVal: newVal\n      });\n    }\n  }, {\n    key: \"addName\",\n    value: function addName(name) {\n      if (!this.hasName(name)) {\n        var oldName = this.name();\n        var newName = oldName ? oldName + ' ' + name : name;\n        this.name(newName);\n      }\n      return this;\n    }\n  }, {\n    key: \"hasName\",\n    value: function hasName(name) {\n      if (!name) {\n        return false;\n      }\n      var fullName = this.name();\n      if (!fullName) {\n        return false;\n      }\n      var names = (fullName || '').split(/\\s/g);\n      return names.indexOf(name) !== -1;\n    }\n  }, {\n    key: \"removeName\",\n    value: function removeName(name) {\n      var names = (this.name() || '').split(/\\s/g);\n      var index = names.indexOf(name);\n      if (index !== -1) {\n        names.splice(index, 1);\n        this.name(names.join(' '));\n      }\n      return this;\n    }\n  }, {\n    key: \"setAttr\",\n    value: function setAttr(attr, val) {\n      var func = this[SET + Util_1.Util._capitalize(attr)];\n      if (Util_1.Util._isFunction(func)) {\n        func.call(this, val);\n      } else {\n        this._setAttr(attr, val);\n      }\n      return this;\n    }\n  }, {\n    key: \"_requestDraw\",\n    value: function _requestDraw() {\n      if (Global_1.Konva.autoDrawEnabled) {\n        var drawNode = this.getLayer() || this.getStage();\n        drawNode === null || drawNode === void 0 ? void 0 : drawNode.batchDraw();\n      }\n    }\n  }, {\n    key: \"_setAttr\",\n    value: function _setAttr(key, val) {\n      var oldVal = this.attrs[key];\n      if (oldVal === val && !Util_1.Util.isObject(val)) {\n        return;\n      }\n      if (val === undefined || val === null) {\n        delete this.attrs[key];\n      } else {\n        this.attrs[key] = val;\n      }\n      if (this._shouldFireChangeEvents) {\n        this._fireChangeEvent(key, oldVal, val);\n      }\n      this._requestDraw();\n    }\n  }, {\n    key: \"_setComponentAttr\",\n    value: function _setComponentAttr(key, component, val) {\n      var oldVal;\n      if (val !== undefined) {\n        oldVal = this.attrs[key];\n        if (!oldVal) {\n          this.attrs[key] = this.getAttr(key);\n        }\n        this.attrs[key][component] = val;\n        this._fireChangeEvent(key, oldVal, val);\n      }\n    }\n  }, {\n    key: \"_fireAndBubble\",\n    value: function _fireAndBubble(eventType, evt, compareShape) {\n      if (evt && this.nodeType === SHAPE) {\n        evt.target = this;\n      }\n      var shouldStop = (eventType === MOUSEENTER || eventType === MOUSELEAVE) && (compareShape && (this === compareShape || this.isAncestorOf && this.isAncestorOf(compareShape)) || this.nodeType === 'Stage' && !compareShape);\n      if (!shouldStop) {\n        this._fire(eventType, evt);\n        var stopBubble = (eventType === MOUSEENTER || eventType === MOUSELEAVE) && compareShape && compareShape.isAncestorOf && compareShape.isAncestorOf(this) && !compareShape.isAncestorOf(this.parent);\n        if ((evt && !evt.cancelBubble || !evt) && this.parent && this.parent.isListening() && !stopBubble) {\n          if (compareShape && compareShape.parent) {\n            this._fireAndBubble.call(this.parent, eventType, evt, compareShape);\n          } else {\n            this._fireAndBubble.call(this.parent, eventType, evt);\n          }\n        }\n      }\n    }\n  }, {\n    key: \"_getProtoListeners\",\n    value: function _getProtoListeners(eventType) {\n      var _a, _b, _c;\n      var allListeners = (_a = this._cache.get(ALL_LISTENERS)) !== null && _a !== void 0 ? _a : {};\n      var events = allListeners === null || allListeners === void 0 ? void 0 : allListeners[eventType];\n      if (events === undefined) {\n        events = [];\n        var obj = Object.getPrototypeOf(this);\n        while (obj) {\n          var _events;\n          var hierarchyEvents = (_c = (_b = obj.eventListeners) === null || _b === void 0 ? void 0 : _b[eventType]) !== null && _c !== void 0 ? _c : [];\n          (_events = events).push.apply(_events, _toConsumableArray(hierarchyEvents));\n          obj = Object.getPrototypeOf(obj);\n        }\n        allListeners[eventType] = events;\n        this._cache.set(ALL_LISTENERS, allListeners);\n      }\n      return events;\n    }\n  }, {\n    key: \"_fire\",\n    value: function _fire(eventType, evt) {\n      evt = evt || {};\n      evt.currentTarget = this;\n      evt.type = eventType;\n      var topListeners = this._getProtoListeners(eventType);\n      if (topListeners) {\n        for (var i = 0; i < topListeners.length; i++) {\n          topListeners[i].handler.call(this, evt);\n        }\n      }\n      var selfListeners = this.eventListeners[eventType];\n      if (selfListeners) {\n        for (var i = 0; i < selfListeners.length; i++) {\n          selfListeners[i].handler.call(this, evt);\n        }\n      }\n    }\n  }, {\n    key: \"draw\",\n    value: function draw() {\n      this.drawScene();\n      this.drawHit();\n      return this;\n    }\n  }, {\n    key: \"_createDragElement\",\n    value: function _createDragElement(evt) {\n      var pointerId = evt ? evt.pointerId : undefined;\n      var stage = this.getStage();\n      var ap = this.getAbsolutePosition();\n      var pos = stage._getPointerById(pointerId) || stage._changedPointerPositions[0] || ap;\n      DragAndDrop_1.DD._dragElements.set(this._id, {\n        node: this,\n        startPointerPos: pos,\n        offset: {\n          x: pos.x - ap.x,\n          y: pos.y - ap.y\n        },\n        dragStatus: 'ready',\n        pointerId: pointerId\n      });\n    }\n  }, {\n    key: \"startDrag\",\n    value: function startDrag(evt) {\n      var bubbleEvent = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n      if (!DragAndDrop_1.DD._dragElements.has(this._id)) {\n        this._createDragElement(evt);\n      }\n      var elem = DragAndDrop_1.DD._dragElements.get(this._id);\n      elem.dragStatus = 'dragging';\n      this.fire('dragstart', {\n        type: 'dragstart',\n        target: this,\n        evt: evt && evt.evt\n      }, bubbleEvent);\n    }\n  }, {\n    key: \"_setDragPosition\",\n    value: function _setDragPosition(evt, elem) {\n      var pos = this.getStage()._getPointerById(elem.pointerId);\n      if (!pos) {\n        return;\n      }\n      var newNodePos = {\n        x: pos.x - elem.offset.x,\n        y: pos.y - elem.offset.y\n      };\n      var dbf = this.dragBoundFunc();\n      if (dbf !== undefined) {\n        var bounded = dbf.call(this, newNodePos, evt);\n        if (!bounded) {\n          Util_1.Util.warn('dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.');\n        } else {\n          newNodePos = bounded;\n        }\n      }\n      if (!this._lastPos || this._lastPos.x !== newNodePos.x || this._lastPos.y !== newNodePos.y) {\n        this.setAbsolutePosition(newNodePos);\n        this._requestDraw();\n      }\n      this._lastPos = newNodePos;\n    }\n  }, {\n    key: \"stopDrag\",\n    value: function stopDrag(evt) {\n      var elem = DragAndDrop_1.DD._dragElements.get(this._id);\n      if (elem) {\n        elem.dragStatus = 'stopped';\n      }\n      DragAndDrop_1.DD._endDragBefore(evt);\n      DragAndDrop_1.DD._endDragAfter(evt);\n    }\n  }, {\n    key: \"setDraggable\",\n    value: function setDraggable(draggable) {\n      this._setAttr('draggable', draggable);\n      this._dragChange();\n    }\n  }, {\n    key: \"isDragging\",\n    value: function isDragging() {\n      var elem = DragAndDrop_1.DD._dragElements.get(this._id);\n      return elem ? elem.dragStatus === 'dragging' : false;\n    }\n  }, {\n    key: \"_listenDrag\",\n    value: function _listenDrag() {\n      this._dragCleanup();\n      this.on('mousedown.konva touchstart.konva', function (evt) {\n        var _this6 = this;\n        var shouldCheckButton = evt.evt['button'] !== undefined;\n        var canDrag = !shouldCheckButton || Global_1.Konva.dragButtons.indexOf(evt.evt['button']) >= 0;\n        if (!canDrag) {\n          return;\n        }\n        if (this.isDragging()) {\n          return;\n        }\n        var hasDraggingChild = false;\n        DragAndDrop_1.DD._dragElements.forEach(function (elem) {\n          if (_this6.isAncestorOf(elem.node)) {\n            hasDraggingChild = true;\n          }\n        });\n        if (!hasDraggingChild) {\n          this._createDragElement(evt);\n        }\n      });\n    }\n  }, {\n    key: \"_dragChange\",\n    value: function _dragChange() {\n      if (this.attrs.draggable) {\n        this._listenDrag();\n      } else {\n        this._dragCleanup();\n        var stage = this.getStage();\n        if (!stage) {\n          return;\n        }\n        var dragElement = DragAndDrop_1.DD._dragElements.get(this._id);\n        var isDragging = dragElement && dragElement.dragStatus === 'dragging';\n        var isReady = dragElement && dragElement.dragStatus === 'ready';\n        if (isDragging) {\n          this.stopDrag();\n        } else if (isReady) {\n          DragAndDrop_1.DD._dragElements.delete(this._id);\n        }\n      }\n    }\n  }, {\n    key: \"_dragCleanup\",\n    value: function _dragCleanup() {\n      this.off('mousedown.konva');\n      this.off('touchstart.konva');\n    }\n  }, {\n    key: \"isClientRectOnScreen\",\n    value: function isClientRectOnScreen() {\n      var margin = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {\n        x: 0,\n        y: 0\n      };\n      var stage = this.getStage();\n      if (!stage) {\n        return false;\n      }\n      var screenRect = {\n        x: -margin.x,\n        y: -margin.y,\n        width: stage.width() + 2 * margin.x,\n        height: stage.height() + 2 * margin.y\n      };\n      return Util_1.Util.haveIntersection(screenRect, this.getClientRect());\n    }\n  }], [{\n    key: \"create\",\n    value: function create(data, container) {\n      if (Util_1.Util._isString(data)) {\n        data = JSON.parse(data);\n      }\n      return this._createNode(data, container);\n    }\n  }, {\n    key: \"_createNode\",\n    value: function _createNode(obj, container) {\n      var className = Node.prototype.getClassName.call(obj),\n        children = obj.children,\n        no,\n        len,\n        n;\n      if (container) {\n        obj.attrs.container = container;\n      }\n      if (!Global_1.Konva[className]) {\n        Util_1.Util.warn('Can not find a node with class name \"' + className + '\". Fallback to \"Shape\".');\n        className = 'Shape';\n      }\n      var Class = Global_1.Konva[className];\n      no = new Class(obj.attrs);\n      if (children) {\n        len = children.length;\n        for (n = 0; n < len; n++) {\n          no.add(Node._createNode(children[n]));\n        }\n      }\n      return no;\n    }\n  }]);\n  return Node;\n}();\nexports.Node = Node;\nNode.prototype.nodeType = 'Node';\nNode.prototype._attrsAffectingSize = [];\nNode.prototype.eventListeners = {};\nNode.prototype.on.call(Node.prototype, TRANSFORM_CHANGE_STR, function () {\n  if (this._batchingTransformChange) {\n    this._needClearTransformCache = true;\n    return;\n  }\n  this._clearCache(TRANSFORM);\n  this._clearSelfAndDescendantCache(ABSOLUTE_TRANSFORM);\n});\nNode.prototype.on.call(Node.prototype, 'visibleChange.konva', function () {\n  this._clearSelfAndDescendantCache(VISIBLE);\n});\nNode.prototype.on.call(Node.prototype, 'listeningChange.konva', function () {\n  this._clearSelfAndDescendantCache(LISTENING);\n});\nNode.prototype.on.call(Node.prototype, 'opacityChange.konva', function () {\n  this._clearSelfAndDescendantCache(ABSOLUTE_OPACITY);\n});\nvar addGetterSetter = Factory_1.Factory.addGetterSetter;\naddGetterSetter(Node, 'zIndex');\naddGetterSetter(Node, 'absolutePosition');\naddGetterSetter(Node, 'position');\naddGetterSetter(Node, 'x', 0, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'y', 0, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'globalCompositeOperation', 'source-over', (0, Validators_1.getStringValidator)());\naddGetterSetter(Node, 'opacity', 1, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'name', '', (0, Validators_1.getStringValidator)());\naddGetterSetter(Node, 'id', '', (0, Validators_1.getStringValidator)());\naddGetterSetter(Node, 'rotation', 0, (0, Validators_1.getNumberValidator)());\nFactory_1.Factory.addComponentsGetterSetter(Node, 'scale', ['x', 'y']);\naddGetterSetter(Node, 'scaleX', 1, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'scaleY', 1, (0, Validators_1.getNumberValidator)());\nFactory_1.Factory.addComponentsGetterSetter(Node, 'skew', ['x', 'y']);\naddGetterSetter(Node, 'skewX', 0, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'skewY', 0, (0, Validators_1.getNumberValidator)());\nFactory_1.Factory.addComponentsGetterSetter(Node, 'offset', ['x', 'y']);\naddGetterSetter(Node, 'offsetX', 0, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'offsetY', 0, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'dragDistance', null, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'width', 0, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'height', 0, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'listening', true, (0, Validators_1.getBooleanValidator)());\naddGetterSetter(Node, 'preventDefault', true, (0, Validators_1.getBooleanValidator)());\naddGetterSetter(Node, 'filters', null, function (val) {\n  this._filterUpToDate = false;\n  return val;\n});\naddGetterSetter(Node, 'visible', true, (0, Validators_1.getBooleanValidator)());\naddGetterSetter(Node, 'transformsEnabled', 'all', (0, Validators_1.getStringValidator)());\naddGetterSetter(Node, 'size');\naddGetterSetter(Node, 'dragBoundFunc');\naddGetterSetter(Node, 'draggable', false, (0, Validators_1.getBooleanValidator)());\nFactory_1.Factory.backCompat(Node, {\n  rotateDeg: 'rotate',\n  setRotationDeg: 'setRotation',\n  getRotationDeg: 'getRotation'\n});","map":{"version":3,"names":["_toConsumableArray","require","default","_classCallCheck","_createClass","Object","defineProperty","exports","value","Node","Util_1","Factory_1","Canvas_1","Global_1","DragAndDrop_1","Validators_1","ABSOLUTE_OPACITY","ALL_LISTENERS","ABSOLUTE_TRANSFORM","ABSOLUTE_SCALE","CANVAS","CHANGE","CHILDREN","KONVA","LISTENING","MOUSEENTER","MOUSELEAVE","NAME","SET","SHAPE","SPACE","STAGE","TRANSFORM","UPPER_STAGE","VISIBLE","TRANSFORM_CHANGE_STR","join","idCounter","config","_id","eventListeners","attrs","index","_allEventListeners","parent","_cache","Map","_attachedDepsListeners","_lastPos","_batchingTransformChange","_needClearTransformCache","_filterUpToDate","_isUnderCache","_dragEventId","_shouldFireChangeEvents","setAttrs","key","hasChildren","_clearCache","attr","get","dirty","delete","clear","_getCache","privateGetter","cache","isTransform","invalid","undefined","call","set","_calculate","name","deps","getter","_this","depsString","map","dep","on","_getCanvasCache","_clearSelfAndDescendantCache","fire","clearCache","has","_this$_cache$get","scene","filter","hit","Util","releaseCanvas","_requestDraw","conf","rect","x","y","width","height","getClientRect","skipTransform","relativeTo","getParent","Math","ceil","pixelRatio","floor","offset","drawBorder","hitCanvasPixelRatio","error","cachedSceneCanvas","SceneCanvas","cachedFilterCanvas","willReadFrequently","cachedHitCanvas","HitCanvas","sceneContext","getContext","hitContext","isCache","imageSmoothingEnabled","_context","save","translate","drawScene","drawHit","restore","beginPath","closePath","setAttr","stroke","isCached","Error","_transformedRect","top","points","minX","minY","maxX","maxY","trans","getAbsoluteTransform","forEach","point","transformed","min","max","_drawCachedSceneCanvas","context","_applyOpacity","_applyGlobalCompositeOperation","canvasCache","cacheCanvas","_getCachedSceneCanvas","ratio","drawImage","_canvas","_drawCachedHitCanvas","hitCanvas","filters","cachedCanvas","sceneCanvas","filterCanvas","filterContext","len","imageData","n","setSize","length","getWidth","getHeight","getImageData","putImageData","e","message","evtStr","handler","arguments","_delegate","apply","events","split","event","parts","baseEvent","push","off","callback","t","_off","dispatchEvent","evt","target","type","addEventListener","removeEventListener","selector","stopNode","targets","findAncestors","i","cloneObject","currentTarget","remove","isDragging","stopDrag","DD","_dragElements","_remove","_clearCaches","children","splice","_setChildrenIndices","destroy","getAttr","method","_capitalize","_isFunction","getAncestors","ancestors","getAttrs","_this2","_batchTransformChanges","_setAttr","isListening","_isListening","listening","isVisible","_isVisible","visible","shouldDrawHit","skipDragCheck","layer","getLayer","layerUnderDrag","elem","dragStatus","node","nodeType","dragSkip","Konva","hitOnDragEnabled","show","hide","getZIndex","getAbsoluteZIndex","depth","getDepth","that","nodes","child","addChildren","concat","getChildren","slice","getStage","func","setPosition","pos","_this3","getPosition","getRelativePointerPosition","getPointerPosition","transform","copy","invert","getAbsolutePosition","haveCachedParent","absoluteMatrix","getMatrix","absoluteTransform","Transform","m","getTranslation","setAbsolutePosition","origTrans","_clearTransform","it","_getAbsoluteTransform","_setTransform","rotation","scaleX","scaleY","offsetX","offsetY","skewX","skewY","move","change","changeX","changeY","_eachAncestorReverse","family","unshift","rotate","theta","moveToTop","warn","moveUp","moveDown","moveToBottom","setZIndex","zIndex","getAbsoluteOpacity","_getAbsoluteOpacity","absOpacity","opacity","moveTo","newContainer","add","toObject","obj","val","defaultValue","nonPlainObject","isObject","_isPlainObject","_isArray","className","getClassName","_prepareToStringify","toJSON","JSON","stringify","includeSelf","res","_isMatch","ancestor","isAncestorOf","findAncestor","selectorArr","replace","sel","isValidSelector","charAt","id","hasName","_getStage","eventType","bubble","_fireAndBubble","_fire","at","transformsEnabled","multiply","getTransform","copyInto","reset","getAbsoluteScale","decompose","getAbsoluteRotation","_getTransform","_a","_b","getAngle","skew","scale","clone","allListeners","listener","constructor","indexOf","_toKonvaCanvas","box","stage","canvas","toCanvas","toDataURL","mimeType","quality","url","toImage","_this4","Promise","resolve","reject","_urlToImage","img","err","toBlob","_this5","blob","size","getSize","getType","getDragDistance","dragDistance","evtListeners","evtName","_fireChangeEvent","oldVal","newVal","addName","oldName","newName","fullName","names","removeName","autoDrawEnabled","drawNode","batchDraw","_setComponentAttr","component","compareShape","shouldStop","stopBubble","cancelBubble","_getProtoListeners","_c","getPrototypeOf","_events","hierarchyEvents","topListeners","selfListeners","draw","_createDragElement","pointerId","ap","_getPointerById","_changedPointerPositions","startPointerPos","startDrag","bubbleEvent","_setDragPosition","newNodePos","dbf","dragBoundFunc","bounded","_endDragBefore","_endDragAfter","setDraggable","draggable","_dragChange","_listenDrag","_dragCleanup","_this6","shouldCheckButton","canDrag","dragButtons","hasDraggingChild","dragElement","isReady","isClientRectOnScreen","margin","screenRect","haveIntersection","create","data","container","_isString","parse","_createNode","prototype","no","Class","_attrsAffectingSize","addGetterSetter","Factory","getNumberValidator","getStringValidator","addComponentsGetterSetter","getBooleanValidator","backCompat","rotateDeg","setRotationDeg","getRotationDeg"],"sources":["C:/Users/Neo/Desktop/WWW/react/skynet/skynet/node_modules/konva/lib/Node.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Node = void 0;\nconst Util_1 = require(\"./Util\");\nconst Factory_1 = require(\"./Factory\");\nconst Canvas_1 = require(\"./Canvas\");\nconst Global_1 = require(\"./Global\");\nconst DragAndDrop_1 = require(\"./DragAndDrop\");\nconst Validators_1 = require(\"./Validators\");\nvar ABSOLUTE_OPACITY = 'absoluteOpacity', ALL_LISTENERS = 'allEventListeners', ABSOLUTE_TRANSFORM = 'absoluteTransform', ABSOLUTE_SCALE = 'absoluteScale', CANVAS = 'canvas', CHANGE = 'Change', CHILDREN = 'children', KONVA = 'konva', LISTENING = 'listening', MOUSEENTER = 'mouseenter', MOUSELEAVE = 'mouseleave', NAME = 'name', SET = 'set', SHAPE = 'Shape', SPACE = ' ', STAGE = 'stage', TRANSFORM = 'transform', UPPER_STAGE = 'Stage', VISIBLE = 'visible', TRANSFORM_CHANGE_STR = [\n    'xChange.konva',\n    'yChange.konva',\n    'scaleXChange.konva',\n    'scaleYChange.konva',\n    'skewXChange.konva',\n    'skewYChange.konva',\n    'rotationChange.konva',\n    'offsetXChange.konva',\n    'offsetYChange.konva',\n    'transformsEnabledChange.konva',\n].join(SPACE);\nlet idCounter = 1;\nclass Node {\n    constructor(config) {\n        this._id = idCounter++;\n        this.eventListeners = {};\n        this.attrs = {};\n        this.index = 0;\n        this._allEventListeners = null;\n        this.parent = null;\n        this._cache = new Map();\n        this._attachedDepsListeners = new Map();\n        this._lastPos = null;\n        this._batchingTransformChange = false;\n        this._needClearTransformCache = false;\n        this._filterUpToDate = false;\n        this._isUnderCache = false;\n        this._dragEventId = null;\n        this._shouldFireChangeEvents = false;\n        this.setAttrs(config);\n        this._shouldFireChangeEvents = true;\n    }\n    hasChildren() {\n        return false;\n    }\n    _clearCache(attr) {\n        if ((attr === TRANSFORM || attr === ABSOLUTE_TRANSFORM) &&\n            this._cache.get(attr)) {\n            this._cache.get(attr).dirty = true;\n        }\n        else if (attr) {\n            this._cache.delete(attr);\n        }\n        else {\n            this._cache.clear();\n        }\n    }\n    _getCache(attr, privateGetter) {\n        var cache = this._cache.get(attr);\n        var isTransform = attr === TRANSFORM || attr === ABSOLUTE_TRANSFORM;\n        var invalid = cache === undefined || (isTransform && cache.dirty === true);\n        if (invalid) {\n            cache = privateGetter.call(this);\n            this._cache.set(attr, cache);\n        }\n        return cache;\n    }\n    _calculate(name, deps, getter) {\n        if (!this._attachedDepsListeners.get(name)) {\n            const depsString = deps.map((dep) => dep + 'Change.konva').join(SPACE);\n            this.on(depsString, () => {\n                this._clearCache(name);\n            });\n            this._attachedDepsListeners.set(name, true);\n        }\n        return this._getCache(name, getter);\n    }\n    _getCanvasCache() {\n        return this._cache.get(CANVAS);\n    }\n    _clearSelfAndDescendantCache(attr) {\n        this._clearCache(attr);\n        if (attr === ABSOLUTE_TRANSFORM) {\n            this.fire('absoluteTransformChange');\n        }\n    }\n    clearCache() {\n        if (this._cache.has(CANVAS)) {\n            const { scene, filter, hit } = this._cache.get(CANVAS);\n            Util_1.Util.releaseCanvas(scene, filter, hit);\n            this._cache.delete(CANVAS);\n        }\n        this._clearSelfAndDescendantCache();\n        this._requestDraw();\n        return this;\n    }\n    cache(config) {\n        var conf = config || {};\n        var rect = {};\n        if (conf.x === undefined ||\n            conf.y === undefined ||\n            conf.width === undefined ||\n            conf.height === undefined) {\n            rect = this.getClientRect({\n                skipTransform: true,\n                relativeTo: this.getParent(),\n            });\n        }\n        var width = Math.ceil(conf.width || rect.width), height = Math.ceil(conf.height || rect.height), pixelRatio = conf.pixelRatio, x = conf.x === undefined ? Math.floor(rect.x) : conf.x, y = conf.y === undefined ? Math.floor(rect.y) : conf.y, offset = conf.offset || 0, drawBorder = conf.drawBorder || false, hitCanvasPixelRatio = conf.hitCanvasPixelRatio || 1;\n        if (!width || !height) {\n            Util_1.Util.error('Can not cache the node. Width or height of the node equals 0. Caching is skipped.');\n            return;\n        }\n        width += offset * 2 + 1;\n        height += offset * 2 + 1;\n        x -= offset;\n        y -= offset;\n        var cachedSceneCanvas = new Canvas_1.SceneCanvas({\n            pixelRatio: pixelRatio,\n            width: width,\n            height: height,\n        }), cachedFilterCanvas = new Canvas_1.SceneCanvas({\n            pixelRatio: pixelRatio,\n            width: 0,\n            height: 0,\n            willReadFrequently: true,\n        }), cachedHitCanvas = new Canvas_1.HitCanvas({\n            pixelRatio: hitCanvasPixelRatio,\n            width: width,\n            height: height,\n        }), sceneContext = cachedSceneCanvas.getContext(), hitContext = cachedHitCanvas.getContext();\n        cachedHitCanvas.isCache = true;\n        cachedSceneCanvas.isCache = true;\n        this._cache.delete(CANVAS);\n        this._filterUpToDate = false;\n        if (conf.imageSmoothingEnabled === false) {\n            cachedSceneCanvas.getContext()._context.imageSmoothingEnabled = false;\n            cachedFilterCanvas.getContext()._context.imageSmoothingEnabled = false;\n        }\n        sceneContext.save();\n        hitContext.save();\n        sceneContext.translate(-x, -y);\n        hitContext.translate(-x, -y);\n        this._isUnderCache = true;\n        this._clearSelfAndDescendantCache(ABSOLUTE_OPACITY);\n        this._clearSelfAndDescendantCache(ABSOLUTE_SCALE);\n        this.drawScene(cachedSceneCanvas, this);\n        this.drawHit(cachedHitCanvas, this);\n        this._isUnderCache = false;\n        sceneContext.restore();\n        hitContext.restore();\n        if (drawBorder) {\n            sceneContext.save();\n            sceneContext.beginPath();\n            sceneContext.rect(0, 0, width, height);\n            sceneContext.closePath();\n            sceneContext.setAttr('strokeStyle', 'red');\n            sceneContext.setAttr('lineWidth', 5);\n            sceneContext.stroke();\n            sceneContext.restore();\n        }\n        this._cache.set(CANVAS, {\n            scene: cachedSceneCanvas,\n            filter: cachedFilterCanvas,\n            hit: cachedHitCanvas,\n            x: x,\n            y: y,\n        });\n        this._requestDraw();\n        return this;\n    }\n    isCached() {\n        return this._cache.has(CANVAS);\n    }\n    getClientRect(config) {\n        throw new Error('abstract \"getClientRect\" method call');\n    }\n    _transformedRect(rect, top) {\n        var points = [\n            { x: rect.x, y: rect.y },\n            { x: rect.x + rect.width, y: rect.y },\n            { x: rect.x + rect.width, y: rect.y + rect.height },\n            { x: rect.x, y: rect.y + rect.height },\n        ];\n        var minX, minY, maxX, maxY;\n        var trans = this.getAbsoluteTransform(top);\n        points.forEach(function (point) {\n            var transformed = trans.point(point);\n            if (minX === undefined) {\n                minX = maxX = transformed.x;\n                minY = maxY = transformed.y;\n            }\n            minX = Math.min(minX, transformed.x);\n            minY = Math.min(minY, transformed.y);\n            maxX = Math.max(maxX, transformed.x);\n            maxY = Math.max(maxY, transformed.y);\n        });\n        return {\n            x: minX,\n            y: minY,\n            width: maxX - minX,\n            height: maxY - minY,\n        };\n    }\n    _drawCachedSceneCanvas(context) {\n        context.save();\n        context._applyOpacity(this);\n        context._applyGlobalCompositeOperation(this);\n        const canvasCache = this._getCanvasCache();\n        context.translate(canvasCache.x, canvasCache.y);\n        var cacheCanvas = this._getCachedSceneCanvas();\n        var ratio = cacheCanvas.pixelRatio;\n        context.drawImage(cacheCanvas._canvas, 0, 0, cacheCanvas.width / ratio, cacheCanvas.height / ratio);\n        context.restore();\n    }\n    _drawCachedHitCanvas(context) {\n        var canvasCache = this._getCanvasCache(), hitCanvas = canvasCache.hit;\n        context.save();\n        context.translate(canvasCache.x, canvasCache.y);\n        context.drawImage(hitCanvas._canvas, 0, 0, hitCanvas.width / hitCanvas.pixelRatio, hitCanvas.height / hitCanvas.pixelRatio);\n        context.restore();\n    }\n    _getCachedSceneCanvas() {\n        var filters = this.filters(), cachedCanvas = this._getCanvasCache(), sceneCanvas = cachedCanvas.scene, filterCanvas = cachedCanvas.filter, filterContext = filterCanvas.getContext(), len, imageData, n, filter;\n        if (filters) {\n            if (!this._filterUpToDate) {\n                var ratio = sceneCanvas.pixelRatio;\n                filterCanvas.setSize(sceneCanvas.width / sceneCanvas.pixelRatio, sceneCanvas.height / sceneCanvas.pixelRatio);\n                try {\n                    len = filters.length;\n                    filterContext.clear();\n                    filterContext.drawImage(sceneCanvas._canvas, 0, 0, sceneCanvas.getWidth() / ratio, sceneCanvas.getHeight() / ratio);\n                    imageData = filterContext.getImageData(0, 0, filterCanvas.getWidth(), filterCanvas.getHeight());\n                    for (n = 0; n < len; n++) {\n                        filter = filters[n];\n                        if (typeof filter !== 'function') {\n                            Util_1.Util.error('Filter should be type of function, but got ' +\n                                typeof filter +\n                                ' instead. Please check correct filters');\n                            continue;\n                        }\n                        filter.call(this, imageData);\n                        filterContext.putImageData(imageData, 0, 0);\n                    }\n                }\n                catch (e) {\n                    Util_1.Util.error('Unable to apply filter. ' +\n                        e.message +\n                        ' This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.');\n                }\n                this._filterUpToDate = true;\n            }\n            return filterCanvas;\n        }\n        return sceneCanvas;\n    }\n    on(evtStr, handler) {\n        this._cache && this._cache.delete(ALL_LISTENERS);\n        if (arguments.length === 3) {\n            return this._delegate.apply(this, arguments);\n        }\n        var events = evtStr.split(SPACE), len = events.length, n, event, parts, baseEvent, name;\n        for (n = 0; n < len; n++) {\n            event = events[n];\n            parts = event.split('.');\n            baseEvent = parts[0];\n            name = parts[1] || '';\n            if (!this.eventListeners[baseEvent]) {\n                this.eventListeners[baseEvent] = [];\n            }\n            this.eventListeners[baseEvent].push({\n                name: name,\n                handler: handler,\n            });\n        }\n        return this;\n    }\n    off(evtStr, callback) {\n        var events = (evtStr || '').split(SPACE), len = events.length, n, t, event, parts, baseEvent, name;\n        this._cache && this._cache.delete(ALL_LISTENERS);\n        if (!evtStr) {\n            for (t in this.eventListeners) {\n                this._off(t);\n            }\n        }\n        for (n = 0; n < len; n++) {\n            event = events[n];\n            parts = event.split('.');\n            baseEvent = parts[0];\n            name = parts[1];\n            if (baseEvent) {\n                if (this.eventListeners[baseEvent]) {\n                    this._off(baseEvent, name, callback);\n                }\n            }\n            else {\n                for (t in this.eventListeners) {\n                    this._off(t, name, callback);\n                }\n            }\n        }\n        return this;\n    }\n    dispatchEvent(evt) {\n        var e = {\n            target: this,\n            type: evt.type,\n            evt: evt,\n        };\n        this.fire(evt.type, e);\n        return this;\n    }\n    addEventListener(type, handler) {\n        this.on(type, function (evt) {\n            handler.call(this, evt.evt);\n        });\n        return this;\n    }\n    removeEventListener(type) {\n        this.off(type);\n        return this;\n    }\n    _delegate(event, selector, handler) {\n        var stopNode = this;\n        this.on(event, function (evt) {\n            var targets = evt.target.findAncestors(selector, true, stopNode);\n            for (var i = 0; i < targets.length; i++) {\n                evt = Util_1.Util.cloneObject(evt);\n                evt.currentTarget = targets[i];\n                handler.call(targets[i], evt);\n            }\n        });\n    }\n    remove() {\n        if (this.isDragging()) {\n            this.stopDrag();\n        }\n        DragAndDrop_1.DD._dragElements.delete(this._id);\n        this._remove();\n        return this;\n    }\n    _clearCaches() {\n        this._clearSelfAndDescendantCache(ABSOLUTE_TRANSFORM);\n        this._clearSelfAndDescendantCache(ABSOLUTE_OPACITY);\n        this._clearSelfAndDescendantCache(ABSOLUTE_SCALE);\n        this._clearSelfAndDescendantCache(STAGE);\n        this._clearSelfAndDescendantCache(VISIBLE);\n        this._clearSelfAndDescendantCache(LISTENING);\n    }\n    _remove() {\n        this._clearCaches();\n        var parent = this.getParent();\n        if (parent && parent.children) {\n            parent.children.splice(this.index, 1);\n            parent._setChildrenIndices();\n            this.parent = null;\n        }\n    }\n    destroy() {\n        this.remove();\n        this.clearCache();\n        return this;\n    }\n    getAttr(attr) {\n        var method = 'get' + Util_1.Util._capitalize(attr);\n        if (Util_1.Util._isFunction(this[method])) {\n            return this[method]();\n        }\n        return this.attrs[attr];\n    }\n    getAncestors() {\n        var parent = this.getParent(), ancestors = [];\n        while (parent) {\n            ancestors.push(parent);\n            parent = parent.getParent();\n        }\n        return ancestors;\n    }\n    getAttrs() {\n        return this.attrs || {};\n    }\n    setAttrs(config) {\n        this._batchTransformChanges(() => {\n            var key, method;\n            if (!config) {\n                return this;\n            }\n            for (key in config) {\n                if (key === CHILDREN) {\n                    continue;\n                }\n                method = SET + Util_1.Util._capitalize(key);\n                if (Util_1.Util._isFunction(this[method])) {\n                    this[method](config[key]);\n                }\n                else {\n                    this._setAttr(key, config[key]);\n                }\n            }\n        });\n        return this;\n    }\n    isListening() {\n        return this._getCache(LISTENING, this._isListening);\n    }\n    _isListening(relativeTo) {\n        const listening = this.listening();\n        if (!listening) {\n            return false;\n        }\n        const parent = this.getParent();\n        if (parent && parent !== relativeTo && this !== relativeTo) {\n            return parent._isListening(relativeTo);\n        }\n        else {\n            return true;\n        }\n    }\n    isVisible() {\n        return this._getCache(VISIBLE, this._isVisible);\n    }\n    _isVisible(relativeTo) {\n        const visible = this.visible();\n        if (!visible) {\n            return false;\n        }\n        const parent = this.getParent();\n        if (parent && parent !== relativeTo && this !== relativeTo) {\n            return parent._isVisible(relativeTo);\n        }\n        else {\n            return true;\n        }\n    }\n    shouldDrawHit(top, skipDragCheck = false) {\n        if (top) {\n            return this._isVisible(top) && this._isListening(top);\n        }\n        var layer = this.getLayer();\n        var layerUnderDrag = false;\n        DragAndDrop_1.DD._dragElements.forEach((elem) => {\n            if (elem.dragStatus !== 'dragging') {\n                return;\n            }\n            else if (elem.node.nodeType === 'Stage') {\n                layerUnderDrag = true;\n            }\n            else if (elem.node.getLayer() === layer) {\n                layerUnderDrag = true;\n            }\n        });\n        var dragSkip = !skipDragCheck && !Global_1.Konva.hitOnDragEnabled && layerUnderDrag;\n        return this.isListening() && this.isVisible() && !dragSkip;\n    }\n    show() {\n        this.visible(true);\n        return this;\n    }\n    hide() {\n        this.visible(false);\n        return this;\n    }\n    getZIndex() {\n        return this.index || 0;\n    }\n    getAbsoluteZIndex() {\n        var depth = this.getDepth(), that = this, index = 0, nodes, len, n, child;\n        function addChildren(children) {\n            nodes = [];\n            len = children.length;\n            for (n = 0; n < len; n++) {\n                child = children[n];\n                index++;\n                if (child.nodeType !== SHAPE) {\n                    nodes = nodes.concat(child.getChildren().slice());\n                }\n                if (child._id === that._id) {\n                    n = len;\n                }\n            }\n            if (nodes.length > 0 && nodes[0].getDepth() <= depth) {\n                addChildren(nodes);\n            }\n        }\n        if (that.nodeType !== UPPER_STAGE) {\n            addChildren(that.getStage().getChildren());\n        }\n        return index;\n    }\n    getDepth() {\n        var depth = 0, parent = this.parent;\n        while (parent) {\n            depth++;\n            parent = parent.parent;\n        }\n        return depth;\n    }\n    _batchTransformChanges(func) {\n        this._batchingTransformChange = true;\n        func();\n        this._batchingTransformChange = false;\n        if (this._needClearTransformCache) {\n            this._clearCache(TRANSFORM);\n            this._clearSelfAndDescendantCache(ABSOLUTE_TRANSFORM);\n        }\n        this._needClearTransformCache = false;\n    }\n    setPosition(pos) {\n        this._batchTransformChanges(() => {\n            this.x(pos.x);\n            this.y(pos.y);\n        });\n        return this;\n    }\n    getPosition() {\n        return {\n            x: this.x(),\n            y: this.y(),\n        };\n    }\n    getRelativePointerPosition() {\n        if (!this.getStage()) {\n            return null;\n        }\n        var pos = this.getStage().getPointerPosition();\n        if (!pos) {\n            return null;\n        }\n        var transform = this.getAbsoluteTransform().copy();\n        transform.invert();\n        return transform.point(pos);\n    }\n    getAbsolutePosition(top) {\n        let haveCachedParent = false;\n        let parent = this.parent;\n        while (parent) {\n            if (parent.isCached()) {\n                haveCachedParent = true;\n                break;\n            }\n            parent = parent.parent;\n        }\n        if (haveCachedParent && !top) {\n            top = true;\n        }\n        var absoluteMatrix = this.getAbsoluteTransform(top).getMatrix(), absoluteTransform = new Util_1.Transform(), offset = this.offset();\n        absoluteTransform.m = absoluteMatrix.slice();\n        absoluteTransform.translate(offset.x, offset.y);\n        return absoluteTransform.getTranslation();\n    }\n    setAbsolutePosition(pos) {\n        var origTrans = this._clearTransform();\n        this.attrs.x = origTrans.x;\n        this.attrs.y = origTrans.y;\n        delete origTrans.x;\n        delete origTrans.y;\n        this._clearCache(TRANSFORM);\n        var it = this._getAbsoluteTransform().copy();\n        it.invert();\n        it.translate(pos.x, pos.y);\n        pos = {\n            x: this.attrs.x + it.getTranslation().x,\n            y: this.attrs.y + it.getTranslation().y,\n        };\n        this._setTransform(origTrans);\n        this.setPosition({ x: pos.x, y: pos.y });\n        this._clearCache(TRANSFORM);\n        this._clearSelfAndDescendantCache(ABSOLUTE_TRANSFORM);\n        return this;\n    }\n    _setTransform(trans) {\n        var key;\n        for (key in trans) {\n            this.attrs[key] = trans[key];\n        }\n    }\n    _clearTransform() {\n        var trans = {\n            x: this.x(),\n            y: this.y(),\n            rotation: this.rotation(),\n            scaleX: this.scaleX(),\n            scaleY: this.scaleY(),\n            offsetX: this.offsetX(),\n            offsetY: this.offsetY(),\n            skewX: this.skewX(),\n            skewY: this.skewY(),\n        };\n        this.attrs.x = 0;\n        this.attrs.y = 0;\n        this.attrs.rotation = 0;\n        this.attrs.scaleX = 1;\n        this.attrs.scaleY = 1;\n        this.attrs.offsetX = 0;\n        this.attrs.offsetY = 0;\n        this.attrs.skewX = 0;\n        this.attrs.skewY = 0;\n        return trans;\n    }\n    move(change) {\n        var changeX = change.x, changeY = change.y, x = this.x(), y = this.y();\n        if (changeX !== undefined) {\n            x += changeX;\n        }\n        if (changeY !== undefined) {\n            y += changeY;\n        }\n        this.setPosition({ x: x, y: y });\n        return this;\n    }\n    _eachAncestorReverse(func, top) {\n        var family = [], parent = this.getParent(), len, n;\n        if (top && top._id === this._id) {\n            return;\n        }\n        family.unshift(this);\n        while (parent && (!top || parent._id !== top._id)) {\n            family.unshift(parent);\n            parent = parent.parent;\n        }\n        len = family.length;\n        for (n = 0; n < len; n++) {\n            func(family[n]);\n        }\n    }\n    rotate(theta) {\n        this.rotation(this.rotation() + theta);\n        return this;\n    }\n    moveToTop() {\n        if (!this.parent) {\n            Util_1.Util.warn('Node has no parent. moveToTop function is ignored.');\n            return false;\n        }\n        var index = this.index, len = this.parent.getChildren().length;\n        if (index < len - 1) {\n            this.parent.children.splice(index, 1);\n            this.parent.children.push(this);\n            this.parent._setChildrenIndices();\n            return true;\n        }\n        return false;\n    }\n    moveUp() {\n        if (!this.parent) {\n            Util_1.Util.warn('Node has no parent. moveUp function is ignored.');\n            return false;\n        }\n        var index = this.index, len = this.parent.getChildren().length;\n        if (index < len - 1) {\n            this.parent.children.splice(index, 1);\n            this.parent.children.splice(index + 1, 0, this);\n            this.parent._setChildrenIndices();\n            return true;\n        }\n        return false;\n    }\n    moveDown() {\n        if (!this.parent) {\n            Util_1.Util.warn('Node has no parent. moveDown function is ignored.');\n            return false;\n        }\n        var index = this.index;\n        if (index > 0) {\n            this.parent.children.splice(index, 1);\n            this.parent.children.splice(index - 1, 0, this);\n            this.parent._setChildrenIndices();\n            return true;\n        }\n        return false;\n    }\n    moveToBottom() {\n        if (!this.parent) {\n            Util_1.Util.warn('Node has no parent. moveToBottom function is ignored.');\n            return false;\n        }\n        var index = this.index;\n        if (index > 0) {\n            this.parent.children.splice(index, 1);\n            this.parent.children.unshift(this);\n            this.parent._setChildrenIndices();\n            return true;\n        }\n        return false;\n    }\n    setZIndex(zIndex) {\n        if (!this.parent) {\n            Util_1.Util.warn('Node has no parent. zIndex parameter is ignored.');\n            return this;\n        }\n        if (zIndex < 0 || zIndex >= this.parent.children.length) {\n            Util_1.Util.warn('Unexpected value ' +\n                zIndex +\n                ' for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to ' +\n                (this.parent.children.length - 1) +\n                '.');\n        }\n        var index = this.index;\n        this.parent.children.splice(index, 1);\n        this.parent.children.splice(zIndex, 0, this);\n        this.parent._setChildrenIndices();\n        return this;\n    }\n    getAbsoluteOpacity() {\n        return this._getCache(ABSOLUTE_OPACITY, this._getAbsoluteOpacity);\n    }\n    _getAbsoluteOpacity() {\n        var absOpacity = this.opacity();\n        var parent = this.getParent();\n        if (parent && !parent._isUnderCache) {\n            absOpacity *= parent.getAbsoluteOpacity();\n        }\n        return absOpacity;\n    }\n    moveTo(newContainer) {\n        if (this.getParent() !== newContainer) {\n            this._remove();\n            newContainer.add(this);\n        }\n        return this;\n    }\n    toObject() {\n        var obj = {}, attrs = this.getAttrs(), key, val, getter, defaultValue, nonPlainObject;\n        obj.attrs = {};\n        for (key in attrs) {\n            val = attrs[key];\n            nonPlainObject =\n                Util_1.Util.isObject(val) && !Util_1.Util._isPlainObject(val) && !Util_1.Util._isArray(val);\n            if (nonPlainObject) {\n                continue;\n            }\n            getter = typeof this[key] === 'function' && this[key];\n            delete attrs[key];\n            defaultValue = getter ? getter.call(this) : null;\n            attrs[key] = val;\n            if (defaultValue !== val) {\n                obj.attrs[key] = val;\n            }\n        }\n        obj.className = this.getClassName();\n        return Util_1.Util._prepareToStringify(obj);\n    }\n    toJSON() {\n        return JSON.stringify(this.toObject());\n    }\n    getParent() {\n        return this.parent;\n    }\n    findAncestors(selector, includeSelf, stopNode) {\n        var res = [];\n        if (includeSelf && this._isMatch(selector)) {\n            res.push(this);\n        }\n        var ancestor = this.parent;\n        while (ancestor) {\n            if (ancestor === stopNode) {\n                return res;\n            }\n            if (ancestor._isMatch(selector)) {\n                res.push(ancestor);\n            }\n            ancestor = ancestor.parent;\n        }\n        return res;\n    }\n    isAncestorOf(node) {\n        return false;\n    }\n    findAncestor(selector, includeSelf, stopNode) {\n        return this.findAncestors(selector, includeSelf, stopNode)[0];\n    }\n    _isMatch(selector) {\n        if (!selector) {\n            return false;\n        }\n        if (typeof selector === 'function') {\n            return selector(this);\n        }\n        var selectorArr = selector.replace(/ /g, '').split(','), len = selectorArr.length, n, sel;\n        for (n = 0; n < len; n++) {\n            sel = selectorArr[n];\n            if (!Util_1.Util.isValidSelector(sel)) {\n                Util_1.Util.warn('Selector \"' +\n                    sel +\n                    '\" is invalid. Allowed selectors examples are \"#foo\", \".bar\" or \"Group\".');\n                Util_1.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like \"Triangle\".');\n                Util_1.Util.warn('Konva is awesome, right?');\n            }\n            if (sel.charAt(0) === '#') {\n                if (this.id() === sel.slice(1)) {\n                    return true;\n                }\n            }\n            else if (sel.charAt(0) === '.') {\n                if (this.hasName(sel.slice(1))) {\n                    return true;\n                }\n            }\n            else if (this.className === sel || this.nodeType === sel) {\n                return true;\n            }\n        }\n        return false;\n    }\n    getLayer() {\n        var parent = this.getParent();\n        return parent ? parent.getLayer() : null;\n    }\n    getStage() {\n        return this._getCache(STAGE, this._getStage);\n    }\n    _getStage() {\n        var parent = this.getParent();\n        if (parent) {\n            return parent.getStage();\n        }\n        else {\n            return undefined;\n        }\n    }\n    fire(eventType, evt = {}, bubble) {\n        evt.target = evt.target || this;\n        if (bubble) {\n            this._fireAndBubble(eventType, evt);\n        }\n        else {\n            this._fire(eventType, evt);\n        }\n        return this;\n    }\n    getAbsoluteTransform(top) {\n        if (top) {\n            return this._getAbsoluteTransform(top);\n        }\n        else {\n            return this._getCache(ABSOLUTE_TRANSFORM, this._getAbsoluteTransform);\n        }\n    }\n    _getAbsoluteTransform(top) {\n        var at;\n        if (top) {\n            at = new Util_1.Transform();\n            this._eachAncestorReverse(function (node) {\n                var transformsEnabled = node.transformsEnabled();\n                if (transformsEnabled === 'all') {\n                    at.multiply(node.getTransform());\n                }\n                else if (transformsEnabled === 'position') {\n                    at.translate(node.x() - node.offsetX(), node.y() - node.offsetY());\n                }\n            }, top);\n            return at;\n        }\n        else {\n            at = this._cache.get(ABSOLUTE_TRANSFORM) || new Util_1.Transform();\n            if (this.parent) {\n                this.parent.getAbsoluteTransform().copyInto(at);\n            }\n            else {\n                at.reset();\n            }\n            var transformsEnabled = this.transformsEnabled();\n            if (transformsEnabled === 'all') {\n                at.multiply(this.getTransform());\n            }\n            else if (transformsEnabled === 'position') {\n                const x = this.attrs.x || 0;\n                const y = this.attrs.y || 0;\n                const offsetX = this.attrs.offsetX || 0;\n                const offsetY = this.attrs.offsetY || 0;\n                at.translate(x - offsetX, y - offsetY);\n            }\n            at.dirty = false;\n            return at;\n        }\n    }\n    getAbsoluteScale(top) {\n        var parent = this;\n        while (parent) {\n            if (parent._isUnderCache) {\n                top = parent;\n            }\n            parent = parent.getParent();\n        }\n        const transform = this.getAbsoluteTransform(top);\n        const attrs = transform.decompose();\n        return {\n            x: attrs.scaleX,\n            y: attrs.scaleY,\n        };\n    }\n    getAbsoluteRotation() {\n        return this.getAbsoluteTransform().decompose().rotation;\n    }\n    getTransform() {\n        return this._getCache(TRANSFORM, this._getTransform);\n    }\n    _getTransform() {\n        var _a, _b;\n        var m = this._cache.get(TRANSFORM) || new Util_1.Transform();\n        m.reset();\n        var x = this.x(), y = this.y(), rotation = Global_1.Konva.getAngle(this.rotation()), scaleX = (_a = this.attrs.scaleX) !== null && _a !== void 0 ? _a : 1, scaleY = (_b = this.attrs.scaleY) !== null && _b !== void 0 ? _b : 1, skewX = this.attrs.skewX || 0, skewY = this.attrs.skewY || 0, offsetX = this.attrs.offsetX || 0, offsetY = this.attrs.offsetY || 0;\n        if (x !== 0 || y !== 0) {\n            m.translate(x, y);\n        }\n        if (rotation !== 0) {\n            m.rotate(rotation);\n        }\n        if (skewX !== 0 || skewY !== 0) {\n            m.skew(skewX, skewY);\n        }\n        if (scaleX !== 1 || scaleY !== 1) {\n            m.scale(scaleX, scaleY);\n        }\n        if (offsetX !== 0 || offsetY !== 0) {\n            m.translate(-1 * offsetX, -1 * offsetY);\n        }\n        m.dirty = false;\n        return m;\n    }\n    clone(obj) {\n        var attrs = Util_1.Util.cloneObject(this.attrs), key, allListeners, len, n, listener;\n        for (key in obj) {\n            attrs[key] = obj[key];\n        }\n        var node = new this.constructor(attrs);\n        for (key in this.eventListeners) {\n            allListeners = this.eventListeners[key];\n            len = allListeners.length;\n            for (n = 0; n < len; n++) {\n                listener = allListeners[n];\n                if (listener.name.indexOf(KONVA) < 0) {\n                    if (!node.eventListeners[key]) {\n                        node.eventListeners[key] = [];\n                    }\n                    node.eventListeners[key].push(listener);\n                }\n            }\n        }\n        return node;\n    }\n    _toKonvaCanvas(config) {\n        config = config || {};\n        var box = this.getClientRect();\n        var stage = this.getStage(), x = config.x !== undefined ? config.x : Math.floor(box.x), y = config.y !== undefined ? config.y : Math.floor(box.y), pixelRatio = config.pixelRatio || 1, canvas = new Canvas_1.SceneCanvas({\n            width: config.width || Math.ceil(box.width) || (stage ? stage.width() : 0),\n            height: config.height ||\n                Math.ceil(box.height) ||\n                (stage ? stage.height() : 0),\n            pixelRatio: pixelRatio,\n        }), context = canvas.getContext();\n        if (config.imageSmoothingEnabled === false) {\n            context._context.imageSmoothingEnabled = false;\n        }\n        context.save();\n        if (x || y) {\n            context.translate(-1 * x, -1 * y);\n        }\n        this.drawScene(canvas);\n        context.restore();\n        return canvas;\n    }\n    toCanvas(config) {\n        return this._toKonvaCanvas(config)._canvas;\n    }\n    toDataURL(config) {\n        config = config || {};\n        var mimeType = config.mimeType || null, quality = config.quality || null;\n        var url = this._toKonvaCanvas(config).toDataURL(mimeType, quality);\n        if (config.callback) {\n            config.callback(url);\n        }\n        return url;\n    }\n    toImage(config) {\n        return new Promise((resolve, reject) => {\n            try {\n                const callback = config === null || config === void 0 ? void 0 : config.callback;\n                if (callback)\n                    delete config.callback;\n                Util_1.Util._urlToImage(this.toDataURL(config), function (img) {\n                    resolve(img);\n                    callback === null || callback === void 0 ? void 0 : callback(img);\n                });\n            }\n            catch (err) {\n                reject(err);\n            }\n        });\n    }\n    toBlob(config) {\n        return new Promise((resolve, reject) => {\n            try {\n                const callback = config === null || config === void 0 ? void 0 : config.callback;\n                if (callback)\n                    delete config.callback;\n                this.toCanvas(config).toBlob((blob) => {\n                    resolve(blob);\n                    callback === null || callback === void 0 ? void 0 : callback(blob);\n                });\n            }\n            catch (err) {\n                reject(err);\n            }\n        });\n    }\n    setSize(size) {\n        this.width(size.width);\n        this.height(size.height);\n        return this;\n    }\n    getSize() {\n        return {\n            width: this.width(),\n            height: this.height(),\n        };\n    }\n    getClassName() {\n        return this.className || this.nodeType;\n    }\n    getType() {\n        return this.nodeType;\n    }\n    getDragDistance() {\n        if (this.attrs.dragDistance !== undefined) {\n            return this.attrs.dragDistance;\n        }\n        else if (this.parent) {\n            return this.parent.getDragDistance();\n        }\n        else {\n            return Global_1.Konva.dragDistance;\n        }\n    }\n    _off(type, name, callback) {\n        var evtListeners = this.eventListeners[type], i, evtName, handler;\n        for (i = 0; i < evtListeners.length; i++) {\n            evtName = evtListeners[i].name;\n            handler = evtListeners[i].handler;\n            if ((evtName !== 'konva' || name === 'konva') &&\n                (!name || evtName === name) &&\n                (!callback || callback === handler)) {\n                evtListeners.splice(i, 1);\n                if (evtListeners.length === 0) {\n                    delete this.eventListeners[type];\n                    break;\n                }\n                i--;\n            }\n        }\n    }\n    _fireChangeEvent(attr, oldVal, newVal) {\n        this._fire(attr + CHANGE, {\n            oldVal: oldVal,\n            newVal: newVal,\n        });\n    }\n    addName(name) {\n        if (!this.hasName(name)) {\n            var oldName = this.name();\n            var newName = oldName ? oldName + ' ' + name : name;\n            this.name(newName);\n        }\n        return this;\n    }\n    hasName(name) {\n        if (!name) {\n            return false;\n        }\n        const fullName = this.name();\n        if (!fullName) {\n            return false;\n        }\n        var names = (fullName || '').split(/\\s/g);\n        return names.indexOf(name) !== -1;\n    }\n    removeName(name) {\n        var names = (this.name() || '').split(/\\s/g);\n        var index = names.indexOf(name);\n        if (index !== -1) {\n            names.splice(index, 1);\n            this.name(names.join(' '));\n        }\n        return this;\n    }\n    setAttr(attr, val) {\n        var func = this[SET + Util_1.Util._capitalize(attr)];\n        if (Util_1.Util._isFunction(func)) {\n            func.call(this, val);\n        }\n        else {\n            this._setAttr(attr, val);\n        }\n        return this;\n    }\n    _requestDraw() {\n        if (Global_1.Konva.autoDrawEnabled) {\n            const drawNode = this.getLayer() || this.getStage();\n            drawNode === null || drawNode === void 0 ? void 0 : drawNode.batchDraw();\n        }\n    }\n    _setAttr(key, val) {\n        var oldVal = this.attrs[key];\n        if (oldVal === val && !Util_1.Util.isObject(val)) {\n            return;\n        }\n        if (val === undefined || val === null) {\n            delete this.attrs[key];\n        }\n        else {\n            this.attrs[key] = val;\n        }\n        if (this._shouldFireChangeEvents) {\n            this._fireChangeEvent(key, oldVal, val);\n        }\n        this._requestDraw();\n    }\n    _setComponentAttr(key, component, val) {\n        var oldVal;\n        if (val !== undefined) {\n            oldVal = this.attrs[key];\n            if (!oldVal) {\n                this.attrs[key] = this.getAttr(key);\n            }\n            this.attrs[key][component] = val;\n            this._fireChangeEvent(key, oldVal, val);\n        }\n    }\n    _fireAndBubble(eventType, evt, compareShape) {\n        if (evt && this.nodeType === SHAPE) {\n            evt.target = this;\n        }\n        var shouldStop = (eventType === MOUSEENTER || eventType === MOUSELEAVE) &&\n            ((compareShape &&\n                (this === compareShape ||\n                    (this.isAncestorOf && this.isAncestorOf(compareShape)))) ||\n                (this.nodeType === 'Stage' && !compareShape));\n        if (!shouldStop) {\n            this._fire(eventType, evt);\n            var stopBubble = (eventType === MOUSEENTER || eventType === MOUSELEAVE) &&\n                compareShape &&\n                compareShape.isAncestorOf &&\n                compareShape.isAncestorOf(this) &&\n                !compareShape.isAncestorOf(this.parent);\n            if (((evt && !evt.cancelBubble) || !evt) &&\n                this.parent &&\n                this.parent.isListening() &&\n                !stopBubble) {\n                if (compareShape && compareShape.parent) {\n                    this._fireAndBubble.call(this.parent, eventType, evt, compareShape);\n                }\n                else {\n                    this._fireAndBubble.call(this.parent, eventType, evt);\n                }\n            }\n        }\n    }\n    _getProtoListeners(eventType) {\n        var _a, _b, _c;\n        const allListeners = (_a = this._cache.get(ALL_LISTENERS)) !== null && _a !== void 0 ? _a : {};\n        let events = allListeners === null || allListeners === void 0 ? void 0 : allListeners[eventType];\n        if (events === undefined) {\n            events = [];\n            let obj = Object.getPrototypeOf(this);\n            while (obj) {\n                const hierarchyEvents = (_c = (_b = obj.eventListeners) === null || _b === void 0 ? void 0 : _b[eventType]) !== null && _c !== void 0 ? _c : [];\n                events.push(...hierarchyEvents);\n                obj = Object.getPrototypeOf(obj);\n            }\n            allListeners[eventType] = events;\n            this._cache.set(ALL_LISTENERS, allListeners);\n        }\n        return events;\n    }\n    _fire(eventType, evt) {\n        evt = evt || {};\n        evt.currentTarget = this;\n        evt.type = eventType;\n        const topListeners = this._getProtoListeners(eventType);\n        if (topListeners) {\n            for (var i = 0; i < topListeners.length; i++) {\n                topListeners[i].handler.call(this, evt);\n            }\n        }\n        const selfListeners = this.eventListeners[eventType];\n        if (selfListeners) {\n            for (var i = 0; i < selfListeners.length; i++) {\n                selfListeners[i].handler.call(this, evt);\n            }\n        }\n    }\n    draw() {\n        this.drawScene();\n        this.drawHit();\n        return this;\n    }\n    _createDragElement(evt) {\n        var pointerId = evt ? evt.pointerId : undefined;\n        var stage = this.getStage();\n        var ap = this.getAbsolutePosition();\n        var pos = stage._getPointerById(pointerId) ||\n            stage._changedPointerPositions[0] ||\n            ap;\n        DragAndDrop_1.DD._dragElements.set(this._id, {\n            node: this,\n            startPointerPos: pos,\n            offset: {\n                x: pos.x - ap.x,\n                y: pos.y - ap.y,\n            },\n            dragStatus: 'ready',\n            pointerId,\n        });\n    }\n    startDrag(evt, bubbleEvent = true) {\n        if (!DragAndDrop_1.DD._dragElements.has(this._id)) {\n            this._createDragElement(evt);\n        }\n        const elem = DragAndDrop_1.DD._dragElements.get(this._id);\n        elem.dragStatus = 'dragging';\n        this.fire('dragstart', {\n            type: 'dragstart',\n            target: this,\n            evt: evt && evt.evt,\n        }, bubbleEvent);\n    }\n    _setDragPosition(evt, elem) {\n        const pos = this.getStage()._getPointerById(elem.pointerId);\n        if (!pos) {\n            return;\n        }\n        var newNodePos = {\n            x: pos.x - elem.offset.x,\n            y: pos.y - elem.offset.y,\n        };\n        var dbf = this.dragBoundFunc();\n        if (dbf !== undefined) {\n            const bounded = dbf.call(this, newNodePos, evt);\n            if (!bounded) {\n                Util_1.Util.warn('dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.');\n            }\n            else {\n                newNodePos = bounded;\n            }\n        }\n        if (!this._lastPos ||\n            this._lastPos.x !== newNodePos.x ||\n            this._lastPos.y !== newNodePos.y) {\n            this.setAbsolutePosition(newNodePos);\n            this._requestDraw();\n        }\n        this._lastPos = newNodePos;\n    }\n    stopDrag(evt) {\n        const elem = DragAndDrop_1.DD._dragElements.get(this._id);\n        if (elem) {\n            elem.dragStatus = 'stopped';\n        }\n        DragAndDrop_1.DD._endDragBefore(evt);\n        DragAndDrop_1.DD._endDragAfter(evt);\n    }\n    setDraggable(draggable) {\n        this._setAttr('draggable', draggable);\n        this._dragChange();\n    }\n    isDragging() {\n        const elem = DragAndDrop_1.DD._dragElements.get(this._id);\n        return elem ? elem.dragStatus === 'dragging' : false;\n    }\n    _listenDrag() {\n        this._dragCleanup();\n        this.on('mousedown.konva touchstart.konva', function (evt) {\n            var shouldCheckButton = evt.evt['button'] !== undefined;\n            var canDrag = !shouldCheckButton || Global_1.Konva.dragButtons.indexOf(evt.evt['button']) >= 0;\n            if (!canDrag) {\n                return;\n            }\n            if (this.isDragging()) {\n                return;\n            }\n            var hasDraggingChild = false;\n            DragAndDrop_1.DD._dragElements.forEach((elem) => {\n                if (this.isAncestorOf(elem.node)) {\n                    hasDraggingChild = true;\n                }\n            });\n            if (!hasDraggingChild) {\n                this._createDragElement(evt);\n            }\n        });\n    }\n    _dragChange() {\n        if (this.attrs.draggable) {\n            this._listenDrag();\n        }\n        else {\n            this._dragCleanup();\n            var stage = this.getStage();\n            if (!stage) {\n                return;\n            }\n            const dragElement = DragAndDrop_1.DD._dragElements.get(this._id);\n            const isDragging = dragElement && dragElement.dragStatus === 'dragging';\n            const isReady = dragElement && dragElement.dragStatus === 'ready';\n            if (isDragging) {\n                this.stopDrag();\n            }\n            else if (isReady) {\n                DragAndDrop_1.DD._dragElements.delete(this._id);\n            }\n        }\n    }\n    _dragCleanup() {\n        this.off('mousedown.konva');\n        this.off('touchstart.konva');\n    }\n    isClientRectOnScreen(margin = { x: 0, y: 0 }) {\n        const stage = this.getStage();\n        if (!stage) {\n            return false;\n        }\n        const screenRect = {\n            x: -margin.x,\n            y: -margin.y,\n            width: stage.width() + 2 * margin.x,\n            height: stage.height() + 2 * margin.y,\n        };\n        return Util_1.Util.haveIntersection(screenRect, this.getClientRect());\n    }\n    static create(data, container) {\n        if (Util_1.Util._isString(data)) {\n            data = JSON.parse(data);\n        }\n        return this._createNode(data, container);\n    }\n    static _createNode(obj, container) {\n        var className = Node.prototype.getClassName.call(obj), children = obj.children, no, len, n;\n        if (container) {\n            obj.attrs.container = container;\n        }\n        if (!Global_1.Konva[className]) {\n            Util_1.Util.warn('Can not find a node with class name \"' +\n                className +\n                '\". Fallback to \"Shape\".');\n            className = 'Shape';\n        }\n        const Class = Global_1.Konva[className];\n        no = new Class(obj.attrs);\n        if (children) {\n            len = children.length;\n            for (n = 0; n < len; n++) {\n                no.add(Node._createNode(children[n]));\n            }\n        }\n        return no;\n    }\n}\nexports.Node = Node;\nNode.prototype.nodeType = 'Node';\nNode.prototype._attrsAffectingSize = [];\nNode.prototype.eventListeners = {};\nNode.prototype.on.call(Node.prototype, TRANSFORM_CHANGE_STR, function () {\n    if (this._batchingTransformChange) {\n        this._needClearTransformCache = true;\n        return;\n    }\n    this._clearCache(TRANSFORM);\n    this._clearSelfAndDescendantCache(ABSOLUTE_TRANSFORM);\n});\nNode.prototype.on.call(Node.prototype, 'visibleChange.konva', function () {\n    this._clearSelfAndDescendantCache(VISIBLE);\n});\nNode.prototype.on.call(Node.prototype, 'listeningChange.konva', function () {\n    this._clearSelfAndDescendantCache(LISTENING);\n});\nNode.prototype.on.call(Node.prototype, 'opacityChange.konva', function () {\n    this._clearSelfAndDescendantCache(ABSOLUTE_OPACITY);\n});\nconst addGetterSetter = Factory_1.Factory.addGetterSetter;\naddGetterSetter(Node, 'zIndex');\naddGetterSetter(Node, 'absolutePosition');\naddGetterSetter(Node, 'position');\naddGetterSetter(Node, 'x', 0, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'y', 0, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'globalCompositeOperation', 'source-over', (0, Validators_1.getStringValidator)());\naddGetterSetter(Node, 'opacity', 1, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'name', '', (0, Validators_1.getStringValidator)());\naddGetterSetter(Node, 'id', '', (0, Validators_1.getStringValidator)());\naddGetterSetter(Node, 'rotation', 0, (0, Validators_1.getNumberValidator)());\nFactory_1.Factory.addComponentsGetterSetter(Node, 'scale', ['x', 'y']);\naddGetterSetter(Node, 'scaleX', 1, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'scaleY', 1, (0, Validators_1.getNumberValidator)());\nFactory_1.Factory.addComponentsGetterSetter(Node, 'skew', ['x', 'y']);\naddGetterSetter(Node, 'skewX', 0, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'skewY', 0, (0, Validators_1.getNumberValidator)());\nFactory_1.Factory.addComponentsGetterSetter(Node, 'offset', ['x', 'y']);\naddGetterSetter(Node, 'offsetX', 0, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'offsetY', 0, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'dragDistance', null, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'width', 0, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'height', 0, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'listening', true, (0, Validators_1.getBooleanValidator)());\naddGetterSetter(Node, 'preventDefault', true, (0, Validators_1.getBooleanValidator)());\naddGetterSetter(Node, 'filters', null, function (val) {\n    this._filterUpToDate = false;\n    return val;\n});\naddGetterSetter(Node, 'visible', true, (0, Validators_1.getBooleanValidator)());\naddGetterSetter(Node, 'transformsEnabled', 'all', (0, Validators_1.getStringValidator)());\naddGetterSetter(Node, 'size');\naddGetterSetter(Node, 'dragBoundFunc');\naddGetterSetter(Node, 'draggable', false, (0, Validators_1.getBooleanValidator)());\nFactory_1.Factory.backCompat(Node, {\n    rotateDeg: 'rotate',\n    setRotationDeg: 'setRotation',\n    getRotationDeg: 'getRotation',\n});\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}